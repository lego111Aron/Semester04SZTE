
<!doctype html>
<html lang="hu" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../09_gyakorlat/index.html">
      
      
        <link rel="next" href="../11_gyakorlat/index.html">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.9">
    
    
      
        <title>10. gyakorlat - Alkalmazásfejlesztés I. gyakorlat</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.0d440cfe.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,300i,400,400i,700,700i%7CUbuntu+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Ubuntu";--md-code-font:"Ubuntu Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="Indigo" data-md-color-accent="Indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#10-gyakorlat" class="md-skip">
          Kihagyás
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Élőfej">
    <a href="../.." title="Alkalmazásfejlesztés I. gyakorlat" class="md-header__button md-logo" aria-label="Alkalmazásfejlesztés I. gyakorlat" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 3 1 9l11 6 9-4.91V17h2V9M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Alkalmazásfejlesztés I. gyakorlat
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              10. gyakorlat
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Keresés" placeholder="Keresés" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Keresés">
        
        <button type="reset" class="md-search__icon md-icon" title="Törlés" aria-label="Törlés" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Keresés inicializálása
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigáció" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Alkalmazásfejlesztés I. gyakorlat" class="md-nav__button md-logo" aria-label="Alkalmazásfejlesztés I. gyakorlat" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 3 1 9l11 6 9-4.91V17h2V9M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82Z"/></svg>

    </a>
    Alkalmazásfejlesztés I. gyakorlat
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
      
      
      
        <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
          Általános
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Általános
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Kezdőlap
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../00_Kovetelmenyek/index.html" class="md-nav__link">
        Követelmények
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Jegyzet
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Jegyzet
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../01_gyakorlat/index.html" class="md-nav__link">
        1. gyakorlat (XML + Maven)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../02_gyakorlat/index.html" class="md-nav__link">
        2. gyakorlat (Alap JavaFX elemek)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../03_gyakorlat/index.html" class="md-nav__link">
        3. gyakorlat (Táblázat kezelés)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../04_gyakorlat/index.html" class="md-nav__link">
        4. gyakorlat (FXML)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../05_gyakorlat/index.html" class="md-nav__link">
        5. gyakorlat (DAO)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../06_webapi/index.html" class="md-nav__link">
        6. gyakorlat (Web API)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../06_kivonat/index.html" class="md-nav__link">
        Web API kivonat
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/generics/index.html" class="md-nav__link">
        Extra - Java Generikusok
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/lambda/index.html" class="md-nav__link">
        Extra - Lambda kifejezések
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/troubleshoot/index.html" class="md-nav__link">
        Troubleshoot
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Régi anyag
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Régi anyag
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../01_gyakorlat/index.html" class="md-nav__link">
        1. gyakorlat
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../02_gyakorlat/index.html" class="md-nav__link">
        2. gyakorlat
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../03_gyakorlat/index.html" class="md-nav__link">
        3. gyakorlat
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../04_gyakorlat/index.html" class="md-nav__link">
        4. gyakorlat
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../05_gyakorlat/index.html" class="md-nav__link">
        5. gyakorlat
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../06_gyakorlat/index.html" class="md-nav__link">
        6. gyakorlat
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../07_gyakorlat/index.html" class="md-nav__link">
        7. gyakorlat
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../08_gyakorlat/index.html" class="md-nav__link">
        8. gyakorlat
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../09_gyakorlat/index.html" class="md-nav__link">
        9. gyakorlat
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          10. gyakorlat
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./index.html" class="md-nav__link md-nav__link--active">
        10. gyakorlat
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tartalomjegyzék">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tartalomjegyzék
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#jsp-folytatas" class="md-nav__link">
    JSP folytatás
  </a>
  
    <nav class="md-nav" aria-label="JSP folytatás">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fragment-ek" class="md-nav__link">
    Fragment-ek
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#felhasznalok-kezelese" class="md-nav__link">
    Felhasználók kezelése
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#profil-hozzaadasa" class="md-nav__link">
    Profil hozzáadása
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#torles-es-modositas" class="md-nav__link">
    Törlés és módosítás
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../11_gyakorlat/index.html" class="md-nav__link">
        11. gyakorlat
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../12_gyakorlat/index.html" class="md-nav__link">
        12. gyakorlat
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../13_gyakorlat/index.html" class="md-nav__link">
        13. gyakorlat
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tartalomjegyzék">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tartalomjegyzék
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#jsp-folytatas" class="md-nav__link">
    JSP folytatás
  </a>
  
    <nav class="md-nav" aria-label="JSP folytatás">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fragment-ek" class="md-nav__link">
    Fragment-ek
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#felhasznalok-kezelese" class="md-nav__link">
    Felhasználók kezelése
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#profil-hozzaadasa" class="md-nav__link">
    Profil hozzáadása
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#torles-es-modositas" class="md-nav__link">
    Törlés és módosítás
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="10-gyakorlat">10. gyakorlat<a class="headerlink" href="#10-gyakorlat" title="Permanent link">&para;</a></h1>
<h2 id="jsp-folytatas">JSP folytatás<a class="headerlink" href="#jsp-folytatas" title="Permanent link">&para;</a></h2>
<h3 id="fragment-ek">Fragment-ek<a class="headerlink" href="#fragment-ek" title="Permanent link">&para;</a></h3>
<p>A nem teljes értékű, csak töredék JSP oldalakat <strong>JSP fragment</strong>-eknek nevezzük.</p>
<div class="admonition question">
<p class="admonition-title">Feladat</p>
<p>A person-administrator alkalmazásunk jsp/servlet megvalósításában a <code>menu</code> és a közös <code>header</code> elemek nem önálló JSP oldalak.
Viszont a böngészőből direktben elérhetőek ezek az oldalak. Javítsuk ki, hogy erre ne legyen lehetőség!
Arról már volt szó, hogy amit nem akarunk, hogy a felhasználó elérjen, azt a WEB-INF könyvtárba kell pakolni.
Tegyünk is így: mozgassuk a teljes common mappát a WEB-INF alá!
Ezután állítsuk át a többi oldalon szereplő elérési útvonalakat (../WEB-INF/common/... kell legyen)! </p>
</div>
<h3 id="felhasznalok-kezelese">Felhasználók kezelése<a class="headerlink" href="#felhasznalok-kezelese" title="Permanent link">&para;</a></h3>
<div class="admonition question">
<p class="admonition-title">Feladat</p>
<p>Adjunk hozzá az alkalmazásunkhoz valódi felhasználó kezelést! Jelen esetben a login alkalmával csak beletesszük a session-be és kész.
Legyen lehetőségünk úgy belépni, hogy ténylegesen ellenőrizzük az alkalmazásban, hogy helyes felhasználó jelszó párost adott-e meg a felhasználó.
A jelszavakat titkosítsuk bcrypt algoritmussal!
Ehhez konstruáljuk egy felhasználó táblát, illetve az adott felhasználó külön tudja menedzselni a saját kontaktjait, tehát minden felhasználó csak az általa hozzáadott embereket látja.
Legyen egy regisztráció menüpont is a login-ról elérhető!</p>
</div>
<ol>
<li>
<p>lépés: Dolgozzuk át az adatbázist!
   Az valahogy így kell, hogy kinézzen az átalakítás után:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">CONTACT</span>
<span class="w"> </span><span class="p">(</span>
<span class="w">     </span><span class="n">id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span>
<span class="w">         </span><span class="k">constraint</span><span class="w"> </span><span class="n">CONTACT_pk</span>
<span class="w">             </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="n">autoincrement</span><span class="p">,</span>
<span class="w">     </span><span class="n">name</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">     </span><span class="n">email</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">     </span><span class="n">address</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span>
<span class="w">     </span><span class="n">dateOfBirth</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">     </span><span class="n">company</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span>
<span class="w">     </span><span class="k">position</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span>
<span class="w">     </span><span class="n">user_id</span><span class="w"> </span><span class="nb">int</span>
<span class="w"> </span><span class="p">);</span>

<span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="k">unique</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">CONTACT_email_uindex</span>
<span class="w">     </span><span class="k">on</span><span class="w"> </span><span class="n">CONTACT</span><span class="w"> </span><span class="p">(</span><span class="n">email</span><span class="p">);</span>

<span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">PHONE</span>
<span class="w"> </span><span class="p">(</span>
<span class="w">     </span><span class="n">id</span><span class="w"> </span><span class="nb">integer</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span>
<span class="w">         </span><span class="k">constraint</span><span class="w"> </span><span class="n">PHONE_pk</span>
<span class="w">             </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="n">autoincrement</span><span class="p">,</span>
<span class="w">     </span><span class="nb">number</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">     </span><span class="n">phoneType</span><span class="w"> </span><span class="nb">integer</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">     </span><span class="n">contact_id</span><span class="w"> </span><span class="nb">int</span>
<span class="w">         </span><span class="k">references</span><span class="w"> </span><span class="n">CONTACT</span>
<span class="w"> </span><span class="p">);</span>

<span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="k">USER</span>
<span class="w"> </span><span class="p">(</span>
<span class="w">     </span><span class="n">id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span>
<span class="w">         </span><span class="k">constraint</span><span class="w"> </span><span class="n">USER_pk</span>
<span class="w">             </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="n">autoincrement</span><span class="p">,</span>
<span class="w">     </span><span class="n">username</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">     </span><span class="n">password</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">     </span><span class="n">email</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span>
<span class="w"> </span><span class="p">);</span>

<span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="k">unique</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">USER_email_uindex</span>
<span class="w">     </span><span class="k">on</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="p">(</span><span class="n">email</span><span class="p">);</span>

<span class="w"> </span><span class="k">create</span><span class="w"> </span><span class="k">unique</span><span class="w"> </span><span class="k">index</span><span class="w"> </span><span class="n">USER_username_uindex</span>
<span class="w">     </span><span class="k">on</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="p">(</span><span class="n">username</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>lépés: <code>User</code> model hozzáadása a <code>contacts-core</code>-hoz és <code>Contact</code> model aktualizálása.</p>
<p><code>Contact.java</code>
 <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Contact</span><span class="p">{</span>
<span class="w">     </span><span class="c1">// other properties</span>
<span class="w">     </span><span class="kd">private</span><span class="w"> </span><span class="n">ObjectProperty</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SimpleObjectProperty</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user&quot;</span><span class="p">);</span>

<span class="w">     </span><span class="c1">// getters, setters</span>
<span class="w"> </span><span class="p">}</span>
</code></pre></div></td></tr></table></div></p>
<p><code>User.java</code>
 <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">User</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="kd">private</span><span class="w"> </span><span class="n">IntegerProperty</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SimpleIntegerProperty</span><span class="p">();</span>
<span class="w">     </span><span class="kd">private</span><span class="w"> </span><span class="n">StringProperty</span><span class="w"> </span><span class="n">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SimpleStringProperty</span><span class="p">();</span>
<span class="w">     </span><span class="kd">private</span><span class="w"> </span><span class="n">StringProperty</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SimpleStringProperty</span><span class="p">();</span>
<span class="w">     </span><span class="kd">private</span><span class="w"> </span><span class="n">StringProperty</span><span class="w"> </span><span class="n">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SimpleStringProperty</span><span class="p">();</span>

<span class="w">     </span><span class="c1">// getters, setters</span>
<span class="w"> </span><span class="p">}</span>
</code></pre></div></td></tr></table></div></p>
</li>
<li>
<p>lépés: <code>UserDAO</code> és <code>UserDAOImpl</code> elkészítése</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">UserDAO</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">User</span><span class="w"> </span><span class="nf">getUserById</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">addUser</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">);</span>
<span class="w">    </span><span class="n">User</span><span class="w"> </span><span class="nf">login</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">password</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>A <code>UserDAO</code>-ban semmilyen különleges nincs.
  Lehetőséget ad lekérdezésre, hozzáadásra (regisztráció), illetve bejelentkezésre.</p>
<p>A konkrét megvalósítás:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">UserDAOImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">UserDAO</span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">UserDAOImpl</span><span class="w"> </span><span class="n">instance</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">DB_CONN_STR</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ContactConfiguration</span><span class="p">.</span><span class="na">getValue</span><span class="p">(</span><span class="s">&quot;db.url&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">UserDAOImpl</span><span class="w"> </span><span class="nf">getInstance</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">instance</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">Class</span><span class="p">.</span><span class="na">forName</span><span class="p">(</span><span class="s">&quot;org.sqlite.JDBC&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ClassNotFoundException</span><span class="w"> </span><span class="n">e1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">e1</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="n">instance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">UserDAOImpl</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">instance</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="nf">UserDAOImpl</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="nf">getUserById</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">(</span><span class="n">Connection</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DriverManager</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="n">DB_CONN_STR</span><span class="p">);</span>
<span class="w">            </span><span class="n">PreparedStatement</span><span class="w"> </span><span class="n">pst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="p">.</span><span class="na">prepareStatement</span><span class="p">(</span><span class="s">&quot;SELECT * FROM USER WHERE id = ?&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">pst</span><span class="p">.</span><span class="na">setInt</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>

<span class="w">            </span><span class="n">ResultSet</span><span class="w"> </span><span class="n">rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pst</span><span class="p">.</span><span class="na">executeQuery</span><span class="p">();</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">next</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">User</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">User</span><span class="p">();</span>
<span class="w">                </span><span class="n">u</span><span class="p">.</span><span class="na">setId</span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">getInt</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="w">                </span><span class="n">u</span><span class="p">.</span><span class="na">setUsername</span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
<span class="w">                </span><span class="n">u</span><span class="p">.</span><span class="na">setEmail</span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
<span class="w">                </span><span class="n">u</span><span class="p">.</span><span class="na">setPassword</span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="mi">4</span><span class="p">));</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">u</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">SQLException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addUser</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">(</span><span class="n">Connection</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DriverManager</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="n">DB_CONN_STR</span><span class="p">);</span>
<span class="w">            </span><span class="n">PreparedStatement</span><span class="w"> </span><span class="n">pst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="p">.</span><span class="na">prepareStatement</span><span class="p">(</span><span class="s">&quot;INSERT INTO USER (username, password, email) VALUES (?,?,?)&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">newPwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BCrypt</span><span class="p">.</span><span class="na">withDefaults</span><span class="p">().</span><span class="na">hashToString</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="na">getPassword</span><span class="p">().</span><span class="na">toCharArray</span><span class="p">());</span>
<span class="w">            </span><span class="n">user</span><span class="p">.</span><span class="na">setPassword</span><span class="p">(</span><span class="n">newPwd</span><span class="p">);</span>
<span class="w">            </span><span class="n">pst</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="na">getUsername</span><span class="p">());</span>
<span class="w">            </span><span class="n">pst</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="na">getPassword</span><span class="p">());</span>
<span class="w">            </span><span class="n">pst</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="na">getEmail</span><span class="p">());</span>

<span class="w">            </span><span class="n">pst</span><span class="p">.</span><span class="na">executeUpdate</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">SQLException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="nf">login</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">password</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">(</span><span class="n">Connection</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DriverManager</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="n">DB_CONN_STR</span><span class="p">);</span>
<span class="w">            </span><span class="n">PreparedStatement</span><span class="w"> </span><span class="n">pst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="p">.</span><span class="na">prepareStatement</span><span class="p">(</span><span class="s">&quot;SELECT * FROM USER WHERE username = ?&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">pst</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">username</span><span class="p">);</span>
<span class="w">            </span><span class="n">ResultSet</span><span class="w"> </span><span class="n">rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pst</span><span class="p">.</span><span class="na">executeQuery</span><span class="p">();</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">next</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>

<span class="w">                </span><span class="n">String</span><span class="w"> </span><span class="n">dbPass</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rs</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&quot;password&quot;</span><span class="p">);</span>
<span class="w">                </span><span class="n">BCrypt</span><span class="p">.</span><span class="na">Result</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BCrypt</span><span class="p">.</span><span class="na">verifyer</span><span class="p">().</span><span class="na">verify</span><span class="p">(</span><span class="n">password</span><span class="p">.</span><span class="na">toCharArray</span><span class="p">(),</span><span class="w"> </span><span class="n">dbPass</span><span class="p">);</span>
<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">verified</span><span class="p">){</span>
<span class="w">                    </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">User</span><span class="p">();</span>
<span class="w">                    </span><span class="n">user</span><span class="p">.</span><span class="na">setUsername</span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&quot;username&quot;</span><span class="p">));</span>
<span class="w">                    </span><span class="n">user</span><span class="p">.</span><span class="na">setPassword</span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&quot;password&quot;</span><span class="p">));</span>
<span class="w">                    </span><span class="n">user</span><span class="p">.</span><span class="na">setEmail</span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&quot;email&quot;</span><span class="p">));</span>
<span class="w">                    </span><span class="n">user</span><span class="p">.</span><span class="na">setId</span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">getInt</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">));</span>
<span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="n">user</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">SQLException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Érdemes megfigyelni, hogy a <code>UserDAOImpl</code> példányosítását a <a href="https://en.wikipedia.org/wiki/Singleton_pattern">Singleton</a> tervezési minta mentén készítettük el, így a <code>getInstance</code> hívással kérhetünk majd egy ilyen példányt (private konstruktor miatt kívülről nem példányosítható).
  A megismert mintát alkalmazhatjuk a többi DAO osztályon is.</p>
<p>Egy további érdekes rész, amikor az <code>addUser</code> metódusban a jelszó hash-elt változatát állítjuk elő, tesszük ezt azért, mert nem szeretnénk a natúr szöveges jelszavunkat menteni a DB-be.
  Ehhez a <a href="https://en.wikipedia.org/wiki/Bcrypt">bcrypt</a> algoritmust használjuk, mely manapság egy javasolt hash-elési algoritmus.
  A JDK nem tartalmaz erre a célre beépített osztályokat, így egy külön függőséget használnuk.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">&lt;dependency&gt;</span>
<span class="w">  </span><span class="nt">&lt;groupId&gt;</span>at.favre.lib<span class="nt">&lt;/groupId&gt;</span>
<span class="w">  </span><span class="nt">&lt;artifactId&gt;</span>bcrypt<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">  </span><span class="nt">&lt;version&gt;</span>0.9.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></td></tr></table></div>
<p>Jelen esetben a az alapbeállításokat használjuk (<code>withDefaults</code>), illetve így állítjuk elő a hash string-et a password alapján.
  További konfigurációkat is megadhatunk, melyről bővebben a lib <a href="https://github.com/patrickfav/bcrypt">github</a> oldalán találunk leírást.
  Miután megvan a hash, ezt beállítjuk a user password-jének és így ezt mentjük az adatbázisba.
  Amikor bejelentkezünk, akkor pedig a megadott jelszót veti össze a library az adatbázisban szereplővel:
  <code>BCrypt.Result result = BCrypt.verifyer().verify(password.toCharArray(), dbPass);</code></p>
</li>
<li>
<p>lépés: Contact DAO updatelése</p>
<p><code>ContactDAO.java</code>
  <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">ContactDAO</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Contact</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findAll</span><span class="p">();</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Contact</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findAll</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">);</span>

<span class="w">    </span><span class="n">Contact</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="n">Contact</span><span class="w"> </span><span class="n">contact</span><span class="p">);</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="n">Contact</span><span class="w"> </span><span class="n">contact</span><span class="p">);</span>

<span class="p">}</span>
</code></pre></div></td></tr></table></div></p>
<p>A <code>ContactDAO</code> úgy változik meg, hogy a <code>findAll</code> paraméterében egy <code>User</code>-t is átadunk.
  A mentéskor szeretnénk jelölni, hogy az újönnan létrehozott kontakt melyik felhasználóhoz tartozik (ezt most már a <code>Contact</code> modellben eltároljuk), illetve, amikor lekérdezünk, akkor egy felhasználóhoz tartozó kontaktot listáját adjuk vissza.
  Mivel az asztali alkalmazásunkban nem kezeltünk felhasználókat és nem is fogunk már visszamenni arra a pontra, hogy ezt implementáljunk, ezért az eredeti függvénylenyomatokat meghagyjuk és biztosítunk olyan lehetőséget, melyben a <code>User</code> is megadható.
  Ennek tükrében a <code>ContactDAOImpl</code> a következőképpen néz ki:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ContactDAOImpl</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">ContactDAO</span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">SELECT_ALL_CONTACTS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;SELECT * FROM CONTACT&quot;</span><span class="p">;</span>
<span class="hll"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">SELECT_ALL_CONTACTS_BY_USER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;SELECT * FROM CONTACT WHERE user_id = ?&quot;</span><span class="p">;</span>
</span><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">INSERT_CONTACT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;INSERT INTO CONTACT (name, email, address, dateOfBirth, company, position, user_id) VALUES (?,?,?,?,?,?,?)&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">UPDATE_CONTACT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;UPDATE CONTACT SET name=?, email = ?, address = ?, dateOfBirth=?, company=?, position = ? WHERE id=?&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">DELETE_CONTACT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;DELETE FROM CONTACT WHERE id = ?&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">connectionURL</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">PhoneDAO</span><span class="w"> </span><span class="n">phoneDAO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">PhoneDAOImpl</span><span class="p">();</span>
<span class="hll"><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">UserDAO</span><span class="w"> </span><span class="n">userDAO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserDAOImpl</span><span class="p">.</span><span class="na">getInstance</span><span class="p">();</span>
</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">ContactDAOImpl</span><span class="p">(){</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Class</span><span class="p">.</span><span class="na">forName</span><span class="p">(</span><span class="s">&quot;org.sqlite.JDBC&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ClassNotFoundException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">connectionURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ContactConfiguration</span><span class="p">.</span><span class="na">getValue</span><span class="p">(</span><span class="s">&quot;db.url&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Contact</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findAll</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">findAll</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="hll"><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Contact</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findAll</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Contact</span><span class="o">&gt;</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>

<span class="w">        </span><span class="k">try</span><span class="p">(</span><span class="n">Connection</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DriverManager</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="n">connectionURL</span><span class="p">);</span>
<span class="w">        </span><span class="p">){</span>
<span class="hll"><span class="w">            </span><span class="n">ResultSet</span><span class="w"> </span><span class="n">rs</span><span class="p">;</span>
</span><span class="hll"><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">user</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">){</span>
</span><span class="hll"><span class="w">                </span><span class="n">Statement</span><span class="w"> </span><span class="n">stmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="na">createStatement</span><span class="p">();</span>
</span><span class="hll"><span class="w">                </span><span class="n">rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stmt</span><span class="p">.</span><span class="na">executeQuery</span><span class="p">(</span><span class="n">SELECT_ALL_CONTACTS</span><span class="p">);</span>
</span><span class="hll"><span class="w">            </span><span class="p">}</span>
</span><span class="hll"><span class="w">            </span><span class="k">else</span><span class="p">{</span>
</span><span class="hll"><span class="w">                </span><span class="n">PreparedStatement</span><span class="w"> </span><span class="n">stmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="na">prepareStatement</span><span class="p">(</span><span class="n">SELECT_ALL_CONTACTS_BY_USER</span><span class="p">);</span>
</span><span class="hll"><span class="w">                </span><span class="n">stmt</span><span class="p">.</span><span class="na">setInt</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
</span><span class="hll"><span class="w">                </span><span class="n">rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stmt</span><span class="p">.</span><span class="na">executeQuery</span><span class="p">();</span>
</span><span class="hll"><span class="w">            </span><span class="p">}</span>
</span>
<span class="w">            </span><span class="k">while</span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">next</span><span class="p">()){</span>
<span class="w">                </span><span class="n">Contact</span><span class="w"> </span><span class="n">contact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Contact</span><span class="p">();</span>
<span class="w">                </span><span class="n">contact</span><span class="p">.</span><span class="na">setId</span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">getInt</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">));</span>
<span class="w">                </span><span class="n">contact</span><span class="p">.</span><span class="na">setName</span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">));</span>
<span class="w">                </span><span class="n">contact</span><span class="p">.</span><span class="na">setEmail</span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&quot;email&quot;</span><span class="p">));</span>
<span class="w">                </span><span class="n">contact</span><span class="p">.</span><span class="na">setAddress</span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&quot;address&quot;</span><span class="p">));</span>
<span class="w">                </span><span class="n">Date</span><span class="w"> </span><span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Date</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&quot;dateOfBirth&quot;</span><span class="p">));</span>
<span class="w">                </span><span class="n">contact</span><span class="p">.</span><span class="na">setDateOfBirth</span><span class="p">(</span><span class="n">date</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">now</span><span class="p">()</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">date</span><span class="p">.</span><span class="na">toLocalDate</span><span class="p">());</span>
<span class="w">                </span><span class="n">contact</span><span class="p">.</span><span class="na">setCompany</span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&quot;company&quot;</span><span class="p">));</span>
<span class="w">                </span><span class="n">contact</span><span class="p">.</span><span class="na">setPosition</span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&quot;position&quot;</span><span class="p">));</span>
<span class="w">                </span><span class="n">contact</span><span class="p">.</span><span class="na">setPhones</span><span class="p">(</span><span class="n">phoneDAO</span><span class="p">.</span><span class="na">findAllByContactId</span><span class="p">(</span><span class="n">contact</span><span class="p">.</span><span class="na">getId</span><span class="p">()));</span>
<span class="hll"><span class="w">                </span><span class="n">contact</span><span class="p">.</span><span class="na">setUser</span><span class="p">(</span><span class="n">userDAO</span><span class="p">.</span><span class="na">getUserById</span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">getInt</span><span class="p">(</span><span class="s">&quot;user_id&quot;</span><span class="p">)));</span>
</span><span class="w">                </span><span class="n">result</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">contact</span><span class="p">);</span>

<span class="w">            </span><span class="p">}</span>

<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">SQLException</span><span class="w"> </span><span class="n">throwables</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">throwables</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Contact</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="n">Contact</span><span class="w"> </span><span class="n">contact</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="p">(</span><span class="n">Connection</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DriverManager</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="n">connectionURL</span><span class="p">);</span>
<span class="w">            </span><span class="n">PreparedStatement</span><span class="w"> </span><span class="n">stmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">contact</span><span class="p">.</span><span class="na">getId</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="na">prepareStatement</span><span class="p">(</span><span class="n">INSERT_CONTACT</span><span class="p">,</span><span class="w"> </span><span class="n">Statement</span><span class="p">.</span><span class="na">RETURN_GENERATED_KEYS</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="na">prepareStatement</span><span class="p">(</span><span class="n">UPDATE_CONTACT</span><span class="p">)</span>
<span class="w">        </span><span class="p">){</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">contact</span><span class="p">.</span><span class="na">getId</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="w"> </span><span class="c1">// UPDATE</span>
<span class="w">                </span><span class="n">stmt</span><span class="p">.</span><span class="na">setInt</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="n">contact</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
<span class="w">            </span><span class="p">}</span>
<span class="hll"><span class="w">            </span><span class="k">else</span><span class="p">{</span>
</span><span class="hll"><span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">contact</span><span class="p">.</span><span class="na">getUser</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">){</span>
</span><span class="hll"><span class="w">                    </span><span class="n">stmt</span><span class="p">.</span><span class="na">setInt</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="n">contact</span><span class="p">.</span><span class="na">getUser</span><span class="p">().</span><span class="na">getId</span><span class="p">());</span>
</span><span class="hll"><span class="w">                </span><span class="p">}</span>
</span><span class="hll"><span class="w">            </span><span class="p">}</span>
</span>
<span class="w">            </span><span class="n">stmt</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">contact</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>
<span class="w">            </span><span class="n">stmt</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">contact</span><span class="p">.</span><span class="na">getEmail</span><span class="p">());</span>
<span class="w">            </span><span class="n">stmt</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">contact</span><span class="p">.</span><span class="na">getAddress</span><span class="p">());</span>
<span class="w">            </span><span class="n">stmt</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">contact</span><span class="p">.</span><span class="na">getDateOfBirth</span><span class="p">().</span><span class="na">toString</span><span class="p">());</span>
<span class="w">            </span><span class="n">stmt</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">contact</span><span class="p">.</span><span class="na">getCompany</span><span class="p">());</span>
<span class="w">            </span><span class="n">stmt</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="n">contact</span><span class="p">.</span><span class="na">getPosition</span><span class="p">());</span>

<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">affectedRows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stmt</span><span class="p">.</span><span class="na">executeUpdate</span><span class="p">();</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">affectedRows</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">contact</span><span class="p">.</span><span class="na">getId</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="w"> </span><span class="c1">// INSERT</span>
<span class="w">                </span><span class="n">ResultSet</span><span class="w"> </span><span class="n">genKeys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stmt</span><span class="p">.</span><span class="na">getGeneratedKeys</span><span class="p">();</span>
<span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">genKeys</span><span class="p">.</span><span class="na">next</span><span class="p">()){</span>
<span class="w">                    </span><span class="n">contact</span><span class="p">.</span><span class="na">setId</span><span class="p">(</span><span class="n">genKeys</span><span class="p">.</span><span class="na">getInt</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">SQLException</span><span class="w"> </span><span class="n">throwables</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">throwables</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">contact</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// delete is unmodified</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>lépés: login updatelése</p>
<p>A login oldalon alapvetően marad minden úgy, ahogy volt de egy linket hozzáadunk, hogy a regisztrálás oldalra át tudjunk navigálni abban az esetben ha még nem volt létrehozott fiókunk.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">&lt;span&gt;&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">&quot;register.jsp&quot;</span><span class="nt">&gt;</span>Register<span class="nt">&lt;/a&gt;&lt;/span&gt;</span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>lépés: LoginController updatelése:</p>
<p>Ahhoz, hogy a bejentkezés az új DAO-val együttműködjön, a LoginController-ben is kell néhány módosítást eszközölnünk.
  Itt már felhasználjuk a DAO nyújtotta <code>login</code> metódust.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doPost</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="p">,</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">request</span><span class="p">.</span><span class="na">setCharacterEncoding</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">response</span><span class="p">.</span><span class="na">setCharacterEncoding</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">UserDAO</span><span class="w"> </span><span class="n">userDAO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserDAOImpl</span><span class="p">.</span><span class="na">getInstance</span><span class="p">();</span>

<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;username&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;password&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userDAO</span><span class="p">.</span><span class="na">login</span><span class="p">(</span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">password</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">){</span>
<span class="w">        </span><span class="n">response</span><span class="p">.</span><span class="na">sendRedirect</span><span class="p">(</span><span class="s">&quot;pages/login.jsp&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">request</span><span class="p">.</span><span class="na">getSession</span><span class="p">().</span><span class="na">setAttribute</span><span class="p">(</span><span class="s">&quot;currentUser&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">);</span>
<span class="w">    </span><span class="n">response</span><span class="p">.</span><span class="na">sendRedirect</span><span class="p">(</span><span class="s">&quot;pages/list-contact.jsp&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>lépés: regisztrációs form</p>
<p>A regisztrációs form valahogy így nézhet ki:
 <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="w"> </span><span class="k">&lt;%@</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="n">contentType</span><span class="o">=</span><span class="s">&quot;text/html;charset=UTF-8&quot;</span><span class="w"> </span><span class="n">language</span><span class="o">=</span><span class="s">&quot;java&quot;</span><span class="w"> </span><span class="k">%&gt;</span>
<span class="w"> </span><span class="nt">&lt;html&gt;</span>
<span class="w"> </span><span class="nt">&lt;head&gt;</span>
<span class="w">     </span><span class="k">&lt;jsp:include page=&quot;../WEB-INF/common/common-header.jsp&quot;/&gt;</span>
<span class="w">     </span><span class="nt">&lt;title&gt;</span>Register<span class="nt">&lt;/title&gt;</span>
<span class="w"> </span><span class="nt">&lt;/head&gt;</span>
<span class="w"> </span><span class="nt">&lt;body&gt;</span>
<span class="w"> </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
<span class="w">     </span><span class="nt">&lt;form</span><span class="w"> </span><span class="na">action=</span><span class="s">&quot;../RegisterController&quot;</span><span class="w"> </span><span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
<span class="w">         </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
<span class="w">             </span><span class="nt">&lt;label</span><span class="w"> </span><span class="na">for=</span><span class="s">&quot;username&quot;</span><span class="nt">&gt;</span>Username<span class="nt">&lt;/label&gt;</span>
<span class="w">             </span><span class="nt">&lt;input</span><span class="w"> </span><span class="err">required</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;username&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;text&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;form-control&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;username&quot;</span>
<span class="w">                 </span><span class="na">placeholder=</span><span class="s">&quot;Username&quot;</span><span class="nt">/&gt;</span>
<span class="w">         </span><span class="nt">&lt;/div&gt;</span>
<span class="w">         </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
<span class="w">             </span><span class="nt">&lt;label</span><span class="w"> </span><span class="na">for=</span><span class="s">&quot;password&quot;</span><span class="nt">&gt;</span>Password<span class="nt">&lt;/label&gt;</span>
<span class="w">             </span><span class="nt">&lt;input</span><span class="w"> </span><span class="err">required</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;password&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;password&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;form-control&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;password&quot;</span>
<span class="w">                 </span><span class="na">placeholder=</span><span class="s">&quot;Password&quot;</span><span class="nt">/&gt;</span>
<span class="w">         </span><span class="nt">&lt;/div&gt;</span>
<span class="w">         </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
<span class="w">             </span><span class="nt">&lt;label</span><span class="w"> </span><span class="na">for=</span><span class="s">&quot;email&quot;</span><span class="nt">&gt;</span>Email<span class="nt">&lt;/label&gt;</span>
<span class="w">             </span><span class="nt">&lt;input</span><span class="w"> </span><span class="err">required</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;email&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;email&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;form-control&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;email&quot;</span>
<span class="w">                 </span><span class="na">placeholder=</span><span class="s">&quot;Email&quot;</span><span class="nt">/&gt;</span>
<span class="w">         </span><span class="nt">&lt;/div&gt;</span>
<span class="w">         </span><span class="nt">&lt;button</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;submit&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;submit&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;btn btn-primary&quot;</span><span class="nt">&gt;</span>Submit<span class="nt">&lt;/button&gt;</span>
<span class="w">     </span><span class="nt">&lt;/form&gt;</span>
<span class="w"> </span><span class="nt">&lt;/div&gt;</span>

<span class="w"> </span><span class="nt">&lt;/body&gt;</span>
<span class="w"> </span><span class="nt">&lt;/html&gt;</span>
</code></pre></div></td></tr></table></div></p>
<p>A regisztrációs formban beérjük a felhasználónevet, a jelszót és az email címet.
  A regisztrációs form az adatokat továbbküldi a <code>RegisterController</code>-nek, mely az adatrétegnek továbbküldi a regisztrációs kérelmet.</p>
<p><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@WebServlet</span><span class="p">(</span><span class="s">&quot;/RegisterController&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">RegisterController</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">HttpServlet</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">UserDAO</span><span class="w"> </span><span class="n">dao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UserDAOImpl</span><span class="p">.</span><span class="na">getInstance</span><span class="p">();</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doPost</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">resp</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="p">,</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">req</span><span class="p">.</span><span class="na">setCharacterEncoding</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">resp</span><span class="p">.</span><span class="na">setCharacterEncoding</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">User</span><span class="p">();</span>
<span class="w">        </span><span class="n">user</span><span class="p">.</span><span class="na">setUsername</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;username&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="n">user</span><span class="p">.</span><span class="na">setEmail</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;email&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="n">user</span><span class="p">.</span><span class="na">setPassword</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;password&quot;</span><span class="p">));</span>

<span class="w">        </span><span class="n">dao</span><span class="p">.</span><span class="na">addUser</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>

<span class="w">        </span><span class="n">resp</span><span class="p">.</span><span class="na">sendRedirect</span><span class="p">(</span><span class="s">&quot;pages/login.jsp&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
  Jelen esetben semmilyen jellegű ellenőrzés nincs, amivel a regisztráció sikerességét ellenőrizzük.</p>
</li>
<li>
<p>lépés: Alakítsunk a hozzáadáson és a listázáson az újfajta DAO-nak megfelelően (kell egy user, akihez tartozó kontaktokat szeretnénk listázni, illetve akinek szeretnénk új kontaktot létrehozni).</p>
<p>Az egyik igen fontos pont, hogy a <code>list-contact.jsp</code>-ben behúzzuk a <code>ContactController</code>-t, melynek ilyen módon a <code>doGet</code> metódusa fog lefutni, mely az alábbit teszi:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="p">...</span>
<span class="kd">private</span><span class="w"> </span><span class="n">ContactDAO</span><span class="w"> </span><span class="n">dao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ContactDAOImpl</span><span class="p">();</span>

<span class="nd">@Override</span>
<span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doGet</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">resp</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="p">,</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">User</span><span class="w"> </span><span class="n">currentUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="w"> </span><span class="n">req</span><span class="p">.</span><span class="na">getSession</span><span class="p">().</span><span class="na">getAttribute</span><span class="p">(</span><span class="s">&quot;currentUser&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Contact</span><span class="o">&gt;</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">findAll</span><span class="p">(</span><span class="n">currentUser</span><span class="p">);</span>
<span class="w">    </span><span class="n">req</span><span class="p">.</span><span class="na">setAttribute</span><span class="p">(</span><span class="s">&quot;contactList&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">all</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">...</span>
</code></pre></div></td></tr></table></div>
<p>A session alapján lekérjük az aktuális felhasználót és csak a hozzá tartozó kontaktokat adjuk vissza.</p>
<p>A hozzáadás form-ja nem változott, csak a common header rész miatt.</p>
<p>Elküldjük a <code>ContactController</code>-nek az összes szükséges paramétert.
  A doPost a következőképpen módosul:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doPost</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="p">,</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">request</span><span class="p">.</span><span class="na">setCharacterEncoding</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// setup params</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">    </span><span class="n">User</span><span class="w"> </span><span class="n">currentUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getSession</span><span class="p">().</span><span class="na">getAttribute</span><span class="p">(</span><span class="s">&quot;currentUser&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">c</span><span class="p">.</span><span class="na">setUser</span><span class="p">(</span><span class="n">currentUser</span><span class="p">);</span>

<span class="w">    </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">    </span><span class="c1">// saving phones</span>

<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Fontos, hogy a request encoding-ját is UTF-8-ra állítsuk be, máskülönben az adatbázisba is rossz encoding-al kerül be az új kontakt (<code>request.setCharacterEncoding("utf-8");</code>).</p>
</li>
<li>
<p>lépés: Lényegében kész vagyunk, de egy-két dolog még kimaradt, mint például a logout átalakítása.</p>
<p>Eddig a cookie-ban volt csak az aktuális user, most viszont a sessionben tároljuk, így ezt is át kell alakítanunk kicsit.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doGet</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="p">,</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">request</span><span class="p">.</span><span class="na">getSession</span><span class="p">().</span><span class="na">removeAttribute</span><span class="p">(</span><span class="s">&quot;username&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="n">response</span><span class="p">.</span><span class="na">sendRedirect</span><span class="p">(</span><span class="s">&quot;pages/login.jsp&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Szimplán töröljük a sessionből a <code>currentUser</code> attribútumot, illetve a login oldalra kalauzoljuk a felhasználót.</p>
</li>
<li>
<p>lépés: Menü update:</p>
<p>A menüsáv jobb oldalán kiírjuk az aktuális felhasználó nevét, illetve az itteni lenyíló menüben biztosítjuk, hogy a felhasználó ki tudjon jelentkezni.
  A menüsáv szintén a cookie-t használta eddig, így ezt is át kell alakítani. Az idevágó kódrészlet:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">&lt;c:if</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;${sessionScope.currentUser.username != null}&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;li</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;nav-item dropdown ml-auto&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;a</span><span class="w"> </span><span class="na">class=</span><span class="s">&#39;nav-link dropdown-toggle&#39;</span><span class="w"> </span><span class="na">href=</span><span class="s">&#39;#&#39;</span><span class="w"> </span><span class="na">id=</span><span class="s">&#39;navbarDropdownMenuLink&#39;</span><span class="w"> </span><span class="na">data-toggle=</span><span class="s">&#39;dropdown&#39;</span><span class="w"> </span><span class="na">aria-haspopup=</span><span class="s">&#39;true&#39;</span><span class="w"> </span><span class="na">aria-expanded=</span><span class="s">&#39;false&#39;</span><span class="nt">&gt;</span>
<span class="w">            </span>${sessionScope.currentUser.username}
<span class="w">        </span><span class="nt">&lt;/a&gt;</span>
<span class="w">        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&#39;dropdown-menu dropdown-menu-right&#39;</span><span class="w"> </span><span class="na">aria-labelledby=</span><span class="s">&#39;navbarDropdownMenuLink&#39;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;a</span><span class="w"> </span><span class="na">class=</span><span class="s">&#39;dropdown-item&#39;</span><span class="w"> </span><span class="na">href=</span><span class="s">&#39;../LogoutController&#39;</span><span class="nt">&gt;</span>Kijelentkezés<span class="nt">&lt;/a&gt;</span>
<span class="w">        </span><span class="nt">&lt;/div&gt;</span>
<span class="w">    </span><span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/c:if&gt;</span>
</code></pre></div></td></tr></table></div>
</li>
<li>
<p>lépés: Filterezés</p>
<p>A login megoldásunk már egészen tűrhető, azonban jelen helyzetben, ha a valamelyik oldalra navigálunk direktben, akkor az oldalt megpróbálja betölteni a rendszer.
  A megfelelő működés az volna, hogy legalább a session-t ellenőrizzük, hogy be van-e jelentkezve a felhasználó.
  Amennyiben igen, akkor az adott oldalra engedjük, máskülönben visszhaírányítjuk a login oldalra.
  Mivel a filterezést minden lehetséges oldalra szeretnénk végrehajtani, így az a következőképpen néz ki:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@WebFilter</span><span class="p">(</span><span class="s">&quot;/*&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AuthFilter</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Filter</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">exclusions</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">init</span><span class="p">(</span><span class="n">FilterConfig</span><span class="w"> </span><span class="n">filterConfig</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">exclusions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span><span class="n">filterConfig</span><span class="p">.</span><span class="na">getServletContext</span><span class="p">().</span><span class="na">getInitParameter</span><span class="p">(</span><span class="s">&quot;login-filter-exclusion&quot;</span><span class="p">).</span><span class="na">split</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">exclusions</span><span class="p">.</span><span class="na">replaceAll</span><span class="p">(</span><span class="n">String</span><span class="p">::</span><span class="n">trim</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doFilter</span><span class="p">(</span><span class="n">ServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">ServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">,</span><span class="w"> </span><span class="n">FilterChain</span><span class="w"> </span><span class="n">chain</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="p">,</span><span class="w"> </span><span class="n">ServletException</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="n">HttpServletRequest</span><span class="p">)</span><span class="w"> </span><span class="n">request</span><span class="p">).</span><span class="na">getServletPath</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">exclusions</span><span class="p">.</span><span class="na">stream</span><span class="p">().</span><span class="na">anyMatch</span><span class="p">(</span><span class="n">path</span><span class="p">::</span><span class="n">equals</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">chain</span><span class="p">.</span><span class="na">doFilter</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">User</span><span class="w"> </span><span class="n">currentUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="w"> </span><span class="p">((</span><span class="n">HttpServletRequest</span><span class="p">)</span><span class="w"> </span><span class="n">request</span><span class="p">).</span><span class="na">getSession</span><span class="p">().</span><span class="na">getAttribute</span><span class="p">(</span><span class="s">&quot;currentUser&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">currentUser</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="p">((</span><span class="n">HttpServletResponse</span><span class="p">)</span><span class="n">response</span><span class="p">).</span><span class="na">sendRedirect</span><span class="p">(((</span><span class="n">HttpServletRequest</span><span class="p">)</span><span class="w"> </span><span class="n">request</span><span class="p">).</span><span class="na">getContextPath</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/pages/login.jsp&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span><span class="p">{</span>
<span class="w">            </span><span class="n">chain</span><span class="p">.</span><span class="na">doFilter</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>A filterezésnél a <code>/*</code>-al mondjuk meg, hogy minden kérésre szeretnénk futtatni a filtert.
  Mivel van több oldal is, amin azonban nem szeretnénk, ha a filter lefutna, így ezeket valamilyen módon meg kell adnunk.
  Sajnos kivételeket nem tudunk megadni a filter url-patter résznél, ezért a <code>web.xml</code>-ben adjuk meg azokat az url-eket, melyekre nem szeretnénk filterezést végrehajtani.
  Még egy technikai problém, hogy egy param-hoz nem tudunk több értéket megadni, így vesszővel elválasztva adjuk ezt meg.
  A Filter-ben pedig a vesszők mentén feldaraboljuk a string-et (init-ben).</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">&lt;context-param&gt;</span>
<span class="w">    </span><span class="nt">&lt;param-name&gt;</span>login-filter-exclusion<span class="nt">&lt;/param-name&gt;</span>
<span class="w">    </span><span class="nt">&lt;param-value&gt;</span>
<span class="w">        </span>/index.jsp,
<span class="w">        </span>/pages/login.jsp,
<span class="w">        </span>/LoginController,
<span class="w">        </span>/pages/register.jsp,
<span class="w">        </span>/RegisterController,
<span class="w">        </span>/css/style.css
<span class="w">    </span><span class="nt">&lt;/param-value&gt;</span>
<span class="nt">&lt;/context-param&gt;</span>
</code></pre></div></td></tr></table></div>
<p>A doFilter metódusban megvizsgáljuk, hogy az aktuális kérés url-je (context url nélkül) megegyezik-e a megadott lista bármely elemével.
  Amennyiben találunk ilyet, akkor továbbengedjük a kérést, máskülönben megvizsgáljuk, hogy be vagyunk-e jelentkezve.
  Ha a session-ben találunk bejelentkezett felhasználót, akkor továbbengedjük a kérést, máskülönben a login-ra irányítjuk.</p>
</li>
</ol>
<p>Ez egy komplexebb feladat volt, de lépésenként szépen fel lehetett építeni az alkalmazás megfelelő működését.
A megoldás megtalálható a pub-on <code>01-contacts-user</code> mappában.</p>
<h3 id="profil-hozzaadasa">Profil hozzáadása<a class="headerlink" href="#profil-hozzaadasa" title="Permanent link">&para;</a></h3>
<div class="admonition question">
<p class="admonition-title">Feladat</p>
<p>Bővítsük az alkalmazást egy profil oldallal, ahol megadhatunk profilképet, leírást is. Az oldalon lehessen updatelni a felhasználó tulajdonságait (jelszót nem kell).</p>
</div>
<p>Elsőként bővítsük a <code>User</code> osztályt a kép és a leírás opciókkal!</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">private</span><span class="w"> </span><span class="n">StringProperty</span><span class="w"> </span><span class="n">description</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SimpleStringProperty</span><span class="p">();</span>
<span class="kd">private</span><span class="w"> </span><span class="n">StringProperty</span><span class="w"> </span><span class="n">profilePic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SimpleStringProperty</span><span class="p">();</span>

<span class="c1">// getters and setters</span>
</code></pre></div></td></tr></table></div>
<p>A <code>UserDAO</code>-t módosítsuk úgy, hogy az az <code>update</code>-re is képes legyen.
Ehhez az <code>addUser</code>-t refaktoráljuk, hogy <code>save</code>-nek hívják!</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">User</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p>Az implementációt pedig a következőképpen módosítsuk:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="p">...</span>
<span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">INSERT_USER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;INSERT INTO USER (username, email, profilePic, description, password) VALUES (?,?,?,?,?)&quot;</span><span class="p">;</span>
<span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">UPDATE_USER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;UPDATE User SET username=?, email=?, profilePic=?, description=? WHERE id=?&quot;</span><span class="p">;</span>
<span class="p">...</span>
<span class="nd">@Override</span>
<span class="kd">public</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">(</span><span class="n">Connection</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DriverManager</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="n">DB_CONN_STR</span><span class="p">);</span>
<span class="w">            </span><span class="n">PreparedStatement</span><span class="w"> </span><span class="n">pst</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="na">getId</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">conn</span><span class="p">.</span><span class="na">prepareStatement</span><span class="p">(</span><span class="n">INSERT_USER</span><span class="p">,</span><span class="w"> </span><span class="n">Statement</span><span class="p">.</span><span class="na">RETURN_GENERATED_KEYS</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">conn</span><span class="p">.</span><span class="na">prepareStatement</span><span class="p">(</span><span class="n">UPDATE_USER</span><span class="p">)</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">pst</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="na">getUsername</span><span class="p">());</span>
<span class="w">        </span><span class="n">pst</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="na">getEmail</span><span class="p">());</span>
<span class="w">        </span><span class="n">pst</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="na">getProfilePic</span><span class="p">());</span>
<span class="w">        </span><span class="n">pst</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="na">getDescription</span><span class="p">());</span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getId</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// UPDATE</span>
<span class="w">            </span><span class="n">pst</span><span class="p">.</span><span class="na">setInt</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span><span class="p">{</span><span class="w"> </span><span class="c1">// INSERT</span>
<span class="w">            </span><span class="n">String</span><span class="w"> </span><span class="n">hashedPwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BCrypt</span><span class="p">.</span><span class="na">withDefaults</span><span class="p">().</span><span class="na">hashToString</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">.</span><span class="na">getPassword</span><span class="p">().</span><span class="na">toCharArray</span><span class="p">());</span>
<span class="w">            </span><span class="n">pst</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">hashedPwd</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">affectedRows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pst</span><span class="p">.</span><span class="na">executeUpdate</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">affectedRows</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getId</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span><span class="w"> </span><span class="c1">// INSERT</span>
<span class="w">            </span><span class="n">ResultSet</span><span class="w"> </span><span class="n">genKeys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pst</span><span class="p">.</span><span class="na">getGeneratedKeys</span><span class="p">();</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">genKeys</span><span class="p">.</span><span class="na">next</span><span class="p">()){</span>
<span class="w">                </span><span class="n">user</span><span class="p">.</span><span class="na">setId</span><span class="p">(</span><span class="n">genKeys</span><span class="p">.</span><span class="na">getInt</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">user</span><span class="p">.</span><span class="na">setPassword</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// do not return even the hashed password for the caller</span>

<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">SQLException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">user</span><span class="p">;</span>

<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Ahhoz, hogy megfelelően működjenek az adatbázis műveletek módosítanunk kell a DB sémát is:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">create</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="k">USER</span>
<span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span>
<span class="w">        </span><span class="k">constraint</span><span class="w"> </span><span class="n">USER_pk</span>
<span class="w">            </span><span class="k">primary</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="n">autoincrement</span><span class="p">,</span>
<span class="w">    </span><span class="n">username</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">    </span><span class="n">password</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">    </span><span class="n">email</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">null</span><span class="p">,</span>
<span class="w">    </span><span class="n">profilePic</span><span class="w"> </span><span class="nb">text</span><span class="p">,</span>
<span class="w">    </span><span class="n">description</span><span class="w"> </span><span class="nb">text</span>
<span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p>A regisztrálási oldalon most nem változtatunk, így nézzük a profil oldalt!</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">&lt;%@</span><span class="w"> </span><span class="n">taglib</span><span class="w"> </span><span class="n">prefix</span><span class="o">=</span><span class="s">&quot;c&quot;</span><span class="w"> </span><span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://java.sun.com/jsp/jstl/core&quot;</span><span class="w"> </span><span class="k">%&gt;</span>
<span class="k">&lt;%@</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="n">contentType</span><span class="o">=</span><span class="s">&quot;text/html;charset=UTF-8&quot;</span><span class="w"> </span><span class="n">language</span><span class="o">=</span><span class="s">&quot;java&quot;</span><span class="w"> </span><span class="k">%&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="w">    </span><span class="k">&lt;jsp:include page=&quot;../WEB-INF/common/common-header.jsp&quot;/&gt;</span>
<span class="hll"><span class="w">    </span><span class="nt">&lt;script</span><span class="w"> </span><span class="na">src=</span><span class="s">&quot;../js/profile.js&quot;</span><span class="w"> </span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class="w">    </span><span class="nt">&lt;title&gt;</span>Profile<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="k">&lt;jsp:include page=&quot;../WEB-INF/common/menu.jsp&quot;/&gt;</span>


<span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;container bootstrap snippet&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;col-sm-10&quot;</span><span class="nt">&gt;&lt;h1&gt;</span>${sessionScope.currentUser.username}<span class="nt">&lt;/h1&gt;&lt;/div&gt;</span>
<span class="w">    </span><span class="nt">&lt;/div&gt;</span>
<span class="w">    </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;col-sm-3&quot;</span><span class="nt">&gt;</span><span class="cm">&lt;!--left col--&gt;</span>
<span class="w">            </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;text-center&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;c:choose&gt;</span>
<span class="w">                    </span><span class="nt">&lt;c:when</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;${sessionScope.currentUser.profilePic.length() &gt; 0}&quot;</span><span class="nt">&gt;</span>
<span class="w">                        </span><span class="nt">&lt;img</span><span class="w"> </span><span class="na">src=</span><span class="s">&quot;${sessionScope.currentUser.profilePic}&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;avatar img-circle img-thumbnail&quot;</span>
<span class="w">                            </span><span class="na">alt=</span><span class="s">&quot;avatar&quot;</span><span class="nt">&gt;</span>
<span class="w">                    </span><span class="nt">&lt;/c:when&gt;</span>
<span class="w">                    </span><span class="nt">&lt;c:otherwise&gt;</span>
<span class="w">                        </span><span class="nt">&lt;img</span><span class="w"> </span><span class="na">src=</span><span class="s">&quot;http://ssl.gstatic.com/accounts/ui/avatar_2x.png&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;avatar img-circle img-thumbnail&quot;</span>
<span class="w">                            </span><span class="na">alt=</span><span class="s">&quot;avatar&quot;</span><span class="nt">&gt;</span>
<span class="w">                    </span><span class="nt">&lt;/c:otherwise&gt;</span>
<span class="w">                </span><span class="nt">&lt;/c:choose&gt;</span>

<span class="w">                </span><span class="nt">&lt;h6&gt;</span>Upload<span class="w"> </span>a<span class="w"> </span>different<span class="w"> </span>photo...<span class="nt">&lt;/h6&gt;</span>
<span class="w">                </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;file&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;text-center center-block file-upload&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;/div&gt;</span>
<span class="w">            </span><span class="nt">&lt;br&gt;</span>

<span class="w">        </span><span class="nt">&lt;/div&gt;</span><span class="cm">&lt;!--/col-3--&gt;</span>
<span class="w">        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;col-sm-9&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;tab-content&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;tab-pane active&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;home&quot;</span><span class="nt">&gt;</span>
<span class="w">                    </span><span class="nt">&lt;hr&gt;</span>
<span class="hll"><span class="w">                    </span><span class="nt">&lt;form</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;form&quot;</span><span class="w"> </span><span class="na">action=</span><span class="s">&quot;../UserController&quot;</span><span class="w"> </span><span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
</span><span class="w">                        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>

<span class="w">                            </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;col-xs-6&quot;</span><span class="nt">&gt;</span>
<span class="w">                                </span><span class="nt">&lt;label</span><span class="w"> </span><span class="na">for=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;&lt;h4&gt;</span>Name<span class="nt">&lt;/h4&gt;&lt;/label&gt;</span>
<span class="w">                                </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;text&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;form-control&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;name&quot;</span>
<span class="w">                                    </span><span class="na">placeholder=</span><span class="s">&quot;Name&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${sessionScope.currentUser.username}&quot;</span><span class="nt">&gt;</span>
<span class="w">                            </span><span class="nt">&lt;/div&gt;</span>
<span class="w">                        </span><span class="nt">&lt;/div&gt;</span>
<span class="w">                        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
<span class="w">                            </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;col-xs-6&quot;</span><span class="nt">&gt;</span>
<span class="w">                                </span><span class="nt">&lt;label</span><span class="w"> </span><span class="na">for=</span><span class="s">&quot;email&quot;</span><span class="nt">&gt;&lt;h4&gt;</span>Email<span class="nt">&lt;/h4&gt;&lt;/label&gt;</span>
<span class="w">                                </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;email&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;form-control&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;email&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;email&quot;</span>
<span class="w">                                    </span><span class="na">placeholder=</span><span class="s">&quot;your@email.com&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${sessionScope.currentUser.email}&quot;</span><span class="nt">&gt;</span>
<span class="w">                            </span><span class="nt">&lt;/div&gt;</span>
<span class="w">                        </span><span class="nt">&lt;/div&gt;</span>
<span class="w">                        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
<span class="w">                            </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;col-xs-6&quot;</span><span class="nt">&gt;</span>
<span class="w">                                </span><span class="nt">&lt;label</span><span class="w"> </span><span class="na">for=</span><span class="s">&quot;description&quot;</span><span class="nt">&gt;&lt;h4&gt;</span>Description<span class="nt">&lt;/h4&gt;&lt;/label&gt;</span>
<span class="w">                                </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;text&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;form-control&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;description&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;description&quot;</span>
<span class="w">                                    </span><span class="na">placeholder=</span><span class="s">&quot;a short description&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${sessionScope.currentUser.description}&quot;</span><span class="nt">&gt;</span>
<span class="w">                            </span><span class="nt">&lt;/div&gt;</span>
<span class="w">                        </span><span class="nt">&lt;/div&gt;</span>
<span class="w">                        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
<span class="w">                            </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;col-xs-12&quot;</span><span class="nt">&gt;</span>
<span class="w">                                </span><span class="nt">&lt;br&gt;</span>
<span class="w">                                </span><span class="nt">&lt;button</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;btn btn-primary&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;submit&quot;</span><span class="nt">&gt;&lt;i</span>
<span class="w">                                        </span><span class="na">class=</span><span class="s">&quot;glyphicon glyphicon-ok-sign&quot;</span><span class="nt">&gt;&lt;/i&gt;</span><span class="w"> </span>Save
<span class="w">                                </span><span class="nt">&lt;/button&gt;</span>
<span class="w">                            </span><span class="nt">&lt;/div&gt;</span>
<span class="w">                        </span><span class="nt">&lt;/div&gt;</span>
<span class="w">                    </span><span class="nt">&lt;/form&gt;</span>

<span class="w">                </span><span class="nt">&lt;/div&gt;</span><span class="cm">&lt;!--/tab-pane--&gt;</span>
<span class="w">            </span><span class="nt">&lt;/div&gt;</span><span class="cm">&lt;!--/tab-content--&gt;</span>

<span class="w">        </span><span class="nt">&lt;/div&gt;</span><span class="cm">&lt;!--/col-9--&gt;</span>
<span class="w">    </span><span class="nt">&lt;/div&gt;</span><span class="cm">&lt;!--/row--&gt;</span>

<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></td></tr></table></div>
<p>A fontosabb sorokat kiemeltük a könnyebbség végett.
Mivel szeretnénk egy olyan működést, melynek során biztosítjuk, hogy új kép kiválasztása esetén a profilképet egyből meg is jelenítjük, így ezt jQuery segítségével oldjuk meg, melyet az első kiemelt sor húz be.
A profil frissítésekor a <code>UserController</code>-hez küldjük a kérést, ahol az aktuálisan bejelentkezett felhasználó adatait módosítjuk (kivéve a jelszót).</p>
<p>Először lássuk a <code>profile.js</code> állományt:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">readURL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">files</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">input</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="mf">0</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">reader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">FileReader</span><span class="p">();</span>

<span class="w">            </span><span class="nx">reader</span><span class="p">.</span><span class="nx">onload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.avatar&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">result</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="nx">reader</span><span class="p">.</span><span class="nx">readAsDataURL</span><span class="p">(</span><span class="nx">input</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="mf">0</span><span class="p">]);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.file-upload&quot;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(){</span>
<span class="w">        </span><span class="nx">readURL</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.form&quot;</span><span class="p">).</span><span class="nx">submit</span><span class="p">(</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">eventObj</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;input /&gt;&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;hidden&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;profilePic&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.avatar&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;src&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="s2">&quot;.form&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div></td></tr></table></div>
<p>Minden esetben, amikor változik a kiválasztott kép, akkor beolvassuk a képet egy <code>FileReader</code> segítségével, majd ezt állítjuk be a profilkép <code>src</code> attribútumának.
Amikor a form-ot submit-eljük, akkor egy rejtett input field-ben adjuk át a <code>profilePic</code> nevű attribútumot a formData-ban, hogy ezt könnyen feldolgozhassuk a szerver oldalon.</p>
<p>Az elküldött információk feldolgozását a <code>UserController</code> <code>doPost</code> metódusa végzi:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@Override</span>
<span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doPost</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">resp</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="p">,</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">User</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="w"> </span><span class="n">req</span><span class="p">.</span><span class="na">getSession</span><span class="p">().</span><span class="na">getAttribute</span><span class="p">(</span><span class="s">&quot;currentUser&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">req</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">).</span><span class="na">isEmpty</span><span class="p">()){</span>
<span class="w">        </span><span class="n">user</span><span class="p">.</span><span class="na">setUsername</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;email&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">req</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;email&quot;</span><span class="p">).</span><span class="na">isEmpty</span><span class="p">()){</span>
<span class="w">        </span><span class="n">user</span><span class="p">.</span><span class="na">setEmail</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;email&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;profilePic&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">req</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;profilePic&quot;</span><span class="p">).</span><span class="na">isEmpty</span><span class="p">()){</span>
<span class="w">        </span><span class="n">user</span><span class="p">.</span><span class="na">setProfilePic</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;profilePic&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;description&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">req</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;description&quot;</span><span class="p">).</span><span class="na">isEmpty</span><span class="p">()){</span>
<span class="w">        </span><span class="n">user</span><span class="p">.</span><span class="na">setDescription</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;description&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">userDAO</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">user</span><span class="p">);</span>

<span class="w">    </span><span class="n">req</span><span class="p">.</span><span class="na">getSession</span><span class="p">().</span><span class="na">setAttribute</span><span class="p">(</span><span class="s">&quot;currentUser&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">);</span>
<span class="w">    </span><span class="n">resp</span><span class="p">.</span><span class="na">sendRedirect</span><span class="p">(</span><span class="s">&quot;pages/profile.jsp&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Elsőként a session-ből kiszedjük az aktuális felhasználót, majd frissítjük az attribútumait és elmentjük az adatbázisban, majd frissítjük a sessionben lévő <code>currentUser</code> objektumot.</p>
<p>Miután ezekkel megvagyunk, helyezzük el a menüben is a profil menüpontot:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code>...
<span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&#39;dropdown-menu dropdown-menu-right&#39;</span><span class="w"> </span><span class="na">aria-labelledby=</span><span class="s">&#39;navbarDropdownMenuLink&#39;</span><span class="nt">&gt;</span>
<span class="hll"><span class="w">    </span><span class="nt">&lt;a</span><span class="w"> </span><span class="na">class=</span><span class="s">&#39;dropdown-item&#39;</span><span class="w"> </span><span class="na">href=</span><span class="s">&#39;../pages/profile.jsp&#39;</span><span class="nt">&gt;</span>Profile<span class="nt">&lt;/a&gt;</span>
</span><span class="w">    </span><span class="nt">&lt;a</span><span class="w"> </span><span class="na">class=</span><span class="s">&#39;dropdown-item&#39;</span><span class="w"> </span><span class="na">href=</span><span class="s">&#39;../LogoutController&#39;</span><span class="nt">&gt;</span>Logout<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;/div&gt;</span>
...
</code></pre></div></td></tr></table></div>
<h3 id="torles-es-modositas">Törlés és módosítás<a class="headerlink" href="#torles-es-modositas" title="Permanent link">&para;</a></h3>
<div class="admonition question">
<p class="admonition-title">Feladat</p>
<p>Bővítsük az alkalmazást törlés és módosítás elemekkel</p>
</div>
<p>Elsőként helyezzük el a törlés és módosítás ikonokat a listában!
Ezekhez az ikonokhoz <a href="https://fontawesome.com/index.html">font-awesome</a>-t használunk, így azt a <code>common-header.jsp</code>-ben be kell húznunk!</p>
<p><code>common-header.jsp</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code>...
<span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css&quot;</span><span class="p">&gt;</span>
...
</code></pre></div></td></tr></table></div>
<p>Ezután a <code>list-contact.jsp</code> oldalon adjunk hozzá egy új oszlopot, melyben ezek az ikonok lesznek megjelenítve:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code>...
<span class="nt">&lt;th</span><span class="w"> </span><span class="na">scope=</span><span class="s">&quot;col&quot;</span><span class="nt">&gt;</span>Actions<span class="nt">&lt;/th&gt;</span>
...
<span class="nt">&lt;td&gt;</span>
<span class="w">    </span><span class="nt">&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">&quot;../UpdateContactController?contactId=${item.id}&quot;</span><span class="nt">&gt;&lt;i</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;fas fa-edit&quot;</span><span class="nt">&gt;&lt;/i&gt;&lt;/a&gt;</span>
<span class="w">    </span><span class="nt">&lt;a</span><span class="w"> </span><span class="na">href=</span><span class="s">&quot;../DeleteContactController?contactId=${item.id}&quot;</span><span class="nt">&gt;&lt;i</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;fas fa-trash&quot;</span><span class="nt">&gt;&lt;/i&gt;&lt;/a&gt;</span>
<span class="nt">&lt;/td&gt;</span>
...
</code></pre></div></td></tr></table></div>
<p>Kezdjünk az <code>UpdateContactController</code> megvalósításával:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@WebServlet</span><span class="p">(</span><span class="s">&quot;/UpdateContactController&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">UpdateContactController</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">HttpServlet</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ContactDAO</span><span class="w"> </span><span class="n">dao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ContactDAOImpl</span><span class="p">();</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doGet</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">resp</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="p">,</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">contactIdStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">req</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;contactId&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">contactIdStr</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">contactIdStr</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">()){</span>
<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">contactId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span><span class="n">contactIdStr</span><span class="p">);</span>
<span class="w">            </span><span class="n">Contact</span><span class="w"> </span><span class="n">contact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">contactId</span><span class="p">);</span>
<span class="w">            </span><span class="n">req</span><span class="p">.</span><span class="na">setAttribute</span><span class="p">(</span><span class="s">&quot;contact&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">contact</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">req</span><span class="p">.</span><span class="na">getRequestDispatcher</span><span class="p">(</span><span class="s">&quot;pages/add-contact.jsp&quot;</span><span class="p">).</span><span class="na">forward</span><span class="p">(</span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">resp</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Maga az update nem egy bonyolult konstrukció.
A queryString-ben elküldött paraméter alapján lekérjük a megfelelő kontaktot, majd ezt a kérésben, mint attribútum elhelyezzük.
Ezek után a a kérést továbbítjuk a <code>add-contact.jsp</code> oldalnak (mely ebben a formában lehet, hogy megérett egy átnevezésre, de most ezzel nem foglalkozunk).
Itt pedig ki fogjuk olvasni a kérésben elhelyezett attribútum összes értékét és ezzel töltjük fel a felületi vezérlőket.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">&lt;%@</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="n">import</span><span class="o">=</span><span class="s">&quot;hu.alkfejl.model.Phone&quot;</span><span class="w"> </span><span class="k">%&gt;</span>
<span class="k">&lt;%@</span><span class="w"> </span><span class="n">taglib</span><span class="w"> </span><span class="n">prefix</span><span class="o">=</span><span class="s">&quot;c&quot;</span><span class="w"> </span><span class="n">uri</span><span class="o">=</span><span class="s">&quot;http://java.sun.com/jsp/jstl/core&quot;</span><span class="w"> </span><span class="k">%&gt;</span>
<span class="k">&lt;%@</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="n">language</span><span class="o">=</span><span class="s">&quot;java&quot;</span><span class="w"> </span><span class="n">contentType</span><span class="o">=</span><span class="s">&quot;text/html; charset=UTF-8&quot;</span><span class="w"> </span><span class="n">pageEncoding</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="w"> </span><span class="k">%&gt;</span>

<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="w">    </span><span class="k">&lt;jsp:include page=&quot;../WEB-INF/common/common-header.jsp&quot;/&gt;</span>
<span class="hll"><span class="w">    </span><span class="nt">&lt;script</span><span class="w"> </span><span class="na">src=</span><span class="s">&quot;${pageContext.request.contextPath}/js/add-contact.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
</span><span class="w">    </span><span class="nt">&lt;title&gt;</span>Add<span class="w"> </span>Contact<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="k">&lt;jsp:include page=&quot;../WEB-INF/common/menu.jsp&quot;/&gt;</span>
<span class="hll"><span class="k">&lt;jsp:useBean id=&quot;contact&quot; class=&quot;hu.alkfejl.model.Contact&quot; scope=&quot;request&quot; /&gt;</span>
</span>
<span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
<span class="hll"><span class="w">    </span><span class="nt">&lt;form</span><span class="w"> </span><span class="na">action=</span><span class="s">&quot;${pageContext.request.contextPath}/ContactController&quot;</span><span class="w"> </span><span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;</span>
</span><span class="hll"><span class="w">        </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;hidden&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;id&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${contact.id}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span class="w">        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;label</span><span class="w"> </span><span class="na">for=</span><span class="s">&quot;name&quot;</span><span class="nt">&gt;</span>Name<span class="nt">&lt;/label&gt;</span>
<span class="w">            </span><span class="nt">&lt;input</span><span class="w"> </span><span class="err">required</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;name&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;text&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;form-control&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;name&quot;</span>
<span class="hll"><span class="w">                   </span><span class="na">placeholder=</span><span class="s">&quot;Enter name&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${contact.name}&quot;</span><span class="nt">/&gt;</span>
</span><span class="w">        </span><span class="nt">&lt;/div&gt;</span>
<span class="w">        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;label</span><span class="w"> </span><span class="na">for=</span><span class="s">&quot;email&quot;</span><span class="nt">&gt;</span>Email<span class="nt">&lt;/label&gt;</span>
<span class="w">            </span><span class="nt">&lt;input</span><span class="w"> </span><span class="err">required</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;email&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;email&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;form-control&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;email&quot;</span>
<span class="hll"><span class="w">                   </span><span class="na">placeholder=</span><span class="s">&quot;Email&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${contact.email}&quot;</span><span class="nt">/&gt;</span>
</span><span class="w">        </span><span class="nt">&lt;/div&gt;</span>
<span class="w">        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;label</span><span class="w"> </span><span class="na">for=</span><span class="s">&quot;dateOfBirth&quot;</span><span class="nt">&gt;</span>Date<span class="w"> </span>of<span class="w"> </span>Birth<span class="nt">&lt;/label&gt;</span>
<span class="w">            </span><span class="nt">&lt;input</span><span class="w"> </span><span class="err">required</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;dateOfBirth&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;dateOfBirth&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;date&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;form-control&quot;</span>
<span class="hll"><span class="w">                   </span><span class="na">placeholder=</span><span class="s">&quot;Date of Birth&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${contact.dateOfBirth}&quot;</span><span class="nt">/&gt;</span>
</span><span class="w">        </span><span class="nt">&lt;/div&gt;</span>
<span class="w">        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;label&gt;</span>Phones<span class="nt">&lt;/label&gt;</span>
<span class="hll"><span class="w">            </span><span class="nt">&lt;c:if</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;${contact.phones.size() &gt; 0}&quot;</span><span class="nt">&gt;</span>
</span><span class="hll"><span class="w">                </span><span class="nt">&lt;c:forEach</span><span class="w"> </span><span class="na">var=</span><span class="s">&quot;phone&quot;</span><span class="w"> </span><span class="na">items=</span><span class="s">&quot;${contact.phones}&quot;</span><span class="nt">&gt;</span>
</span><span class="hll"><span class="w">                    </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class="hll"><span class="w">                        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;col&quot;</span><span class="nt">&gt;</span>
</span><span class="hll"><span class="w">                            </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;phoneValues&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;text&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;form-control mb-3&quot;</span>
</span><span class="hll"><span class="w">                                   </span><span class="na">placeholder=</span><span class="s">&quot;Enter phone number&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${phone.number}&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll"><span class="w">                        </span><span class="nt">&lt;/div&gt;</span>
</span><span class="hll"><span class="w">                        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;col&quot;</span><span class="nt">&gt;</span>
</span><span class="hll"><span class="w">                            </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;phoneTypes&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;custom-select&quot;</span><span class="nt">&gt;</span>
</span><span class="hll"><span class="w">                                </span><span class="nt">&lt;c:forEach</span><span class="w"> </span><span class="na">var=</span><span class="s">&quot;phoneType&quot;</span><span class="w"> </span><span class="na">items=</span><span class="s">&quot;</span><span class="k">&lt;%=</span><span class="n">Phone</span><span class="p">.</span><span class="na">PhoneType</span><span class="p">.</span><span class="na">values</span><span class="p">()</span><span class="k">%&gt;</span><span class="s">&quot;</span><span class="nt">&gt;</span>
</span><span class="hll"><span class="w">                                    </span><span class="nt">&lt;c:if</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;${phone.phoneType.value.equals(phoneType.value)}&quot;</span><span class="nt">&gt;</span>
</span><span class="hll"><span class="w">                                        </span><span class="nt">&lt;option</span><span class="w"> </span><span class="na">selected=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${phoneType.value}&quot;</span><span class="nt">&gt;</span>${phoneType.value}<span class="nt">&lt;/option&gt;</span>
</span><span class="hll"><span class="w">                                    </span><span class="nt">&lt;/c:if&gt;</span>
</span><span class="hll"><span class="w">                                    </span><span class="nt">&lt;c:if</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;${!phone.phoneType.value.equals(phoneType.value)}&quot;</span><span class="nt">&gt;</span>
</span><span class="hll"><span class="w">                                        </span><span class="nt">&lt;option</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${phoneType.value}&quot;</span><span class="nt">&gt;</span>${phoneType.value}<span class="nt">&lt;/option&gt;</span>
</span><span class="hll"><span class="w">                                    </span><span class="nt">&lt;/c:if&gt;</span>
</span><span class="hll"><span class="w">                                </span><span class="nt">&lt;/c:forEach&gt;</span>
</span><span class="hll"><span class="w">                            </span><span class="nt">&lt;/select&gt;</span>
</span><span class="hll"><span class="w">                        </span><span class="nt">&lt;/div&gt;</span>
</span><span class="hll"><span class="w">                        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;col md-2&quot;</span><span class="nt">&gt;</span>
</span><span class="hll"><span class="w">                            </span><span class="nt">&lt;c:if</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;${phone.equals(contact.phones.get(contact.phones.size() - 1))}&quot;</span><span class="nt">&gt;</span>
</span><span class="hll"><span class="w">                                </span><span class="nt">&lt;button</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;button&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;btn btn-secondary&quot;</span><span class="w"> </span><span class="na">onclick=</span><span class="s">&quot;newRow(this)&quot;</span><span class="nt">&gt;</span>New<span class="nt">&lt;/button&gt;</span>
</span><span class="hll"><span class="w">                            </span><span class="nt">&lt;/c:if&gt;</span>
</span><span class="hll"><span class="w">                            </span><span class="nt">&lt;c:if</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;${!phone.equals(contact.phones.get(contact.phones.size() - 1))}&quot;</span><span class="nt">&gt;</span>
</span><span class="hll"><span class="w">                                </span><span class="nt">&lt;button</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;button&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;btn btn-secondary&quot;</span><span class="w"> </span><span class="na">onclick=</span><span class="s">&quot;deleteRow(this)&quot;</span><span class="nt">&gt;</span>Delete<span class="nt">&lt;/button&gt;</span>
</span><span class="hll"><span class="w">                            </span><span class="nt">&lt;/c:if&gt;</span>
</span><span class="hll"><span class="w">                        </span><span class="nt">&lt;/div&gt;</span>
</span><span class="hll"><span class="w">                    </span><span class="nt">&lt;/div&gt;</span>
</span><span class="hll"><span class="w">                </span><span class="nt">&lt;/c:forEach&gt;</span>
</span><span class="hll"><span class="w">            </span><span class="nt">&lt;/c:if&gt;</span>
</span><span class="hll"><span class="w">            </span><span class="nt">&lt;c:if</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;${contact.phones == null or contact.phones.size() == 0}&quot;</span><span class="nt">&gt;</span>
</span><span class="hll"><span class="w">                </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;row&quot;</span><span class="nt">&gt;</span>
</span><span class="hll"><span class="w">                    </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;col&quot;</span><span class="nt">&gt;</span>
</span><span class="hll"><span class="w">                        </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;phoneValues&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;text&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;form-control mb-3&quot;</span>
</span><span class="hll"><span class="w">                               </span><span class="na">placeholder=</span><span class="s">&quot;Enter phone number&quot;</span><span class="nt">/&gt;</span>
</span><span class="hll"><span class="w">                    </span><span class="nt">&lt;/div&gt;</span>
</span><span class="hll"><span class="w">                    </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;col&quot;</span><span class="nt">&gt;</span>
</span><span class="hll"><span class="w">                        </span><span class="nt">&lt;select</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;phoneTypes&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;custom-select&quot;</span><span class="nt">&gt;</span>
</span><span class="hll"><span class="w">                            </span><span class="nt">&lt;c:forEach</span><span class="w"> </span><span class="na">var=</span><span class="s">&quot;phoneType&quot;</span><span class="w"> </span><span class="na">items=</span><span class="s">&quot;</span><span class="k">&lt;%=</span><span class="n">Phone</span><span class="p">.</span><span class="na">PhoneType</span><span class="p">.</span><span class="na">values</span><span class="p">()</span><span class="k">%&gt;</span><span class="s">&quot;</span><span class="nt">&gt;</span>
</span><span class="hll"><span class="w">                                </span><span class="nt">&lt;option</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${phoneType.value}&quot;</span><span class="nt">&gt;</span>${phoneType.value}<span class="nt">&lt;/option&gt;</span>
</span><span class="hll"><span class="w">                            </span><span class="nt">&lt;/c:forEach&gt;</span>
</span><span class="hll"><span class="w">                        </span><span class="nt">&lt;/select&gt;</span>
</span><span class="hll"><span class="w">                    </span><span class="nt">&lt;/div&gt;</span>
</span><span class="hll"><span class="w">                    </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;col md-2&quot;</span><span class="nt">&gt;</span>
</span><span class="hll"><span class="w">                        </span><span class="nt">&lt;button</span><span class="w"> </span><span class="na">onclick=</span><span class="s">&quot;newRow(this)&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;button&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;btn btn-secondary&quot;</span><span class="nt">&gt;</span>New<span class="nt">&lt;/button&gt;</span>
</span><span class="hll"><span class="w">                    </span><span class="nt">&lt;/div&gt;</span>
</span><span class="hll"><span class="w">                </span><span class="nt">&lt;/div&gt;</span>
</span><span class="hll"><span class="w">            </span><span class="nt">&lt;/c:if&gt;</span>
</span><span class="w">        </span><span class="nt">&lt;/div&gt;</span>
<span class="w">        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;label</span><span class="w"> </span><span class="na">for=</span><span class="s">&quot;address&quot;</span><span class="nt">&gt;</span>Address<span class="nt">&lt;/label&gt;</span>
<span class="w">            </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;address&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;address&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;text&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;form-control&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;address&quot;</span>
<span class="hll"><span class="w">                   </span><span class="na">placeholder=</span><span class="s">&quot;Address&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${contact.address}&quot;</span><span class="nt">/&gt;</span>
</span><span class="w">        </span><span class="nt">&lt;/div&gt;</span>
<span class="w">        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;label</span><span class="w"> </span><span class="na">for=</span><span class="s">&quot;company&quot;</span><span class="nt">&gt;</span>Company<span class="nt">&lt;/label&gt;</span>
<span class="w">            </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;company&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;company&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;text&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;form-control&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;company&quot;</span>
<span class="hll"><span class="w">                   </span><span class="na">placeholder=</span><span class="s">&quot;Company&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${contact.company}&quot;</span><span class="nt">/&gt;</span>
</span><span class="w">        </span><span class="nt">&lt;/div&gt;</span>
<span class="w">        </span><span class="nt">&lt;div</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;form-group&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;label</span><span class="w"> </span><span class="na">for=</span><span class="s">&quot;address&quot;</span><span class="nt">&gt;</span>Position<span class="nt">&lt;/label&gt;</span>
<span class="w">            </span><span class="nt">&lt;input</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;position&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;position&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;text&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;form-control&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;position&quot;</span>
<span class="hll"><span class="w">                   </span><span class="na">placeholder=</span><span class="s">&quot;Position&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${contact.position}&quot;</span><span class="nt">/&gt;</span>
</span><span class="w">        </span><span class="nt">&lt;/div&gt;</span>
<span class="w">        </span><span class="nt">&lt;button</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;submit&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;submit&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;btn btn-primary&quot;</span><span class="nt">&gt;</span>Submit<span class="nt">&lt;/button&gt;</span>
<span class="w">    </span><span class="nt">&lt;/form&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></td></tr></table></div>
<p>A fenti kódrészletben kiemeltük a fontosabb változtatásokat.
Először is a forward miatt az <code>add-contact.js</code> elérése nem biztos lesz megfelelő, így a <code>pageContext.request.contextPath</code> URL-t használjuk, mely megadja a context útvonalát (pl.: <code>http://localhost:8080/contacts_web_war</code>).
Ezután az előzetesen a request-ben elhelyezett <code>contact</code> attribútumot kiolvassuk a <code>useBean</code> segítségével, majd ezt fogjuk felhasználni az oldalon, hogy feltöltsük a field-ek értékeit.</p>
<p>A meglévő input field-ek mellett hozzáadunk egy rejtett mezőt az <code>id</code> számára is, mivel err a feldolgozás során szükségünk lesz, hiszen frissíteni szeretnénk.
Ezen felül az összes field-hez megadjuk a <code>value="${contact.property}</code> attribútumot, hogy ki is töltse az input-okat az aktuális értékekkel.</p>
<p>A telefonszámok esetében azonban összetettebb feladatunk van és némi átszervezést is igényel a feladat.
Amennyiben a kontakthoz tartoznak telefonszámok, akkor azokat ki kell írnunk, illetve mindegyik mellett a <code>Delete</code> opciót adjuk meg, kivéve az utolsónál, ahol a <code>New</code> opciót.
Az első <code>c:if</code>, akkor fut le, amikor vannak telefonszámok.
Ebben az esetben végigiterálunk a már megadott telefonszámokon és mindegyikhez megadunk egy <code>div</code>-et (<code>row</code> class-al).
Kiírjuk magát a telefonszámot (40. sor) egy vezérlőben, majd egy lenyílóba belerakjuk az összes <code>phoneType</code> opciót és közben figyeljük, hogy ha az adott <code>phoneType</code> megegyezik azzal, ami ki volt választva, akkor rákerül a <code>selected</code> attribútum is, azaz ő lesz kiválasztva a felületen.</p>
<p>A gombok megadásakor (54-61. sor) figyeljük, hogy az utolsó elemnél vagyunk-e.
Az utolsó elemnél a <code>New</code> szöveg lesz a gombon, illetve a <code>newRow(this)</code> eseménykezelőt adjuk meg.
Ellenkező esetben a <code>Delete</code> szöveget alkalmazzuk és a <code>deleteRow(this)</code> eseménykezelőt.
A <code>newRow</code> és a <code>deleteRow</code> függvényeket az <code>add-contact.js</code>-ben adjuk meg, melyet szintén módosítanunk kellett a kontakt frissítés érdekében.
A 65-82. sorig tartó részben szerepel az, amikor nincs megadva telefonszám a kontakhoz, amely alapján csak egy üres beviteli sort adunk meg.</p>
<p>Ezután lássuk a módosított JavaScript részt:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">newRow</span><span class="p">(</span><span class="nx">button</span><span class="p">){</span>
<span class="w">   </span><span class="nx">button</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="nx">button</span><span class="p">);</span>
<span class="w">   </span><span class="kd">let</span><span class="w"> </span><span class="nx">newRowToAdd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">button</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;.row&#39;</span><span class="p">).</span><span class="nx">clone</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">   </span><span class="nx">newRowToAdd</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>

<span class="w">   </span><span class="nx">button</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;Delete&#39;</span><span class="p">);</span>
<span class="w">   </span><span class="nx">button</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;onclick&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;deleteRow(this)&#39;</span><span class="p">);</span>
<span class="w">   </span><span class="kd">let</span><span class="w"> </span><span class="nx">phoneRows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.row&#39;</span><span class="p">);</span>
<span class="w">   </span><span class="nx">phoneRows</span><span class="p">.</span><span class="nx">last</span><span class="p">().</span><span class="nx">parent</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="nx">newRowToAdd</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">deleteRow</span><span class="p">(</span><span class="nx">button</span><span class="p">){</span>
<span class="w">   </span><span class="nx">button</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;.row&#39;</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>A JS kód funkcionalitása lényegében megmaradt, csupán a kiszerveztük azokat két külön függvénybe.</p>
<p>A fentiek eddig a pontig teljesen jól működnek, azonban a kontakt frissítésekor egy új rekord fog megjelenni, mivel a <code>ContactController</code>-ben is hozzá kell igazítanunk a működést a most megvalósított elemekhez.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doPost</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">response</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="p">,</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">request</span><span class="p">.</span><span class="na">setCharacterEncoding</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">response</span><span class="p">.</span><span class="na">setCharacterEncoding</span><span class="p">(</span><span class="s">&quot;utf-8&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">contactId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">contactId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">NumberFormatException</span><span class="w"> </span><span class="n">ex</span><span class="p">){</span>
<span class="w">        </span><span class="n">ex</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">Contact</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">contactId</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// check if c exists -&gt; if no then construct a new one (it&#39;s a save)</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">){</span>
<span class="w">        </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Contact</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">c</span><span class="p">.</span><span class="na">setName</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="n">c</span><span class="p">.</span><span class="na">setEmail</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;email&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="n">c</span><span class="p">.</span><span class="na">setDateOfBirth</span><span class="p">(</span><span class="n">LocalDate</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;dateOfBirth&quot;</span><span class="p">)));</span>
<span class="w">        </span><span class="n">c</span><span class="p">.</span><span class="na">setAddress</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;address&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="n">c</span><span class="p">.</span><span class="na">setCompany</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;company&quot;</span><span class="p">));</span>
<span class="w">        </span><span class="n">c</span><span class="p">.</span><span class="na">setPosition</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;position&quot;</span><span class="p">));</span>

<span class="w">        </span><span class="n">User</span><span class="w"> </span><span class="n">currentUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getSession</span><span class="p">().</span><span class="na">getAttribute</span><span class="p">(</span><span class="s">&quot;currentUser&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">c</span><span class="p">.</span><span class="na">setUser</span><span class="p">(</span><span class="n">currentUser</span><span class="p">);</span>

<span class="w">        </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">phoneValues</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getParameterValues</span><span class="p">(</span><span class="s">&quot;phoneValues&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">phoneTypes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getParameterValues</span><span class="p">(</span><span class="s">&quot;phoneTypes&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">phoneIds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="na">getParameterValues</span><span class="p">(</span><span class="s">&quot;phoneIds&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Phone</span><span class="o">&gt;</span><span class="w"> </span><span class="n">phones</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">phoneValues</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
<span class="w">            </span><span class="n">Phone</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">phoneIds</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">phoneIds</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">phoneIds</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">()){</span>
<span class="w">                </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">phoneDAO</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">Integer</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span><span class="n">phoneIds</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">));</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">){</span>
<span class="w">                </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Phone</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="n">p</span><span class="p">.</span><span class="na">setNumber</span><span class="p">(</span><span class="n">phoneValues</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">);</span>
<span class="w">            </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">phoneTypeString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">phoneTypes</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">;</span>
<span class="w">            </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">Phone</span><span class="p">.</span><span class="na">PhoneType</span><span class="o">&gt;</span><span class="w"> </span><span class="n">foundPhoneType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">stream</span><span class="p">(</span><span class="n">Phone</span><span class="p">.</span><span class="na">PhoneType</span><span class="p">.</span><span class="na">values</span><span class="p">()).</span><span class="na">filter</span><span class="p">(</span><span class="n">phoneType</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">phoneType</span><span class="p">.</span><span class="na">getValue</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="n">phoneTypeString</span><span class="p">)).</span><span class="na">findFirst</span><span class="p">();</span>
<span class="w">            </span><span class="n">p</span><span class="p">.</span><span class="na">setPhoneType</span><span class="p">(</span><span class="n">foundPhoneType</span><span class="p">.</span><span class="na">orElse</span><span class="p">(</span><span class="n">Phone</span><span class="p">.</span><span class="na">PhoneType</span><span class="p">.</span><span class="na">UNKNOWN</span><span class="p">));</span>
<span class="w">            </span><span class="n">phones</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">c</span><span class="p">.</span><span class="na">setPhones</span><span class="p">(</span><span class="n">phones</span><span class="p">);</span>
<span class="w">        </span><span class="n">dao</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>


<span class="w">        </span><span class="n">response</span><span class="p">.</span><span class="na">sendRedirect</span><span class="p">(</span><span class="s">&quot;pages/list-contact.jsp&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>A legfontosabb az <code>id</code> kiolvasása, mely alapján lekérdezzük a meglévő kontaktot.
Később a <code>save</code> hatására mentés vagy beillesztés is történhet, így ezt nem kell majd igazítanunk.
Ezután feldolgozzuk a telefonszámokat, azonban szükségünk lesz a meglévő id-kra, melyeket a <code>phoneIds</code>-ban küldünk el, így ezt a jsp-ben is el kell helyeznünk egy hidden field-be:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">&lt;input</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;hidden&quot;</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;phoneIds&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${phone.id}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</code></pre></div></td></tr></table></div>
<p>Miután kiolvastuk a megfelelő telefonokat (<code>Phone</code> objektumok létrehozása) elmentjük a kontaktot.
Ezen a ponton egy nagyobb refaktorálást is tegyünk meg, amelyet kicsit halogattunk.
Ennek eredményeképpen a DAO réteget átalakítottuk, hogy a egy kontakt mentése esetén a hozzá tartozó telefonszámokat is frissítse az adatelérési réteg.
A módosításokat ezen a ponton nem fogjuk kifejteni, a módosított DAO elérhető a pub-ban.</p>
<p>Az update mellett a delete-hez tartozó servlet a következőképpen néz ki:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@WebServlet</span><span class="p">(</span><span class="s">&quot;/DeleteContactController&quot;</span><span class="p">)</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">DeleteContactController</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">HttpServlet</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">ContactDAO</span><span class="w"> </span><span class="n">dao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ContactDAOImpl</span><span class="p">.</span><span class="na">getInstance</span><span class="p">();</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doGet</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">resp</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="p">,</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">contactId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;contactId&quot;</span><span class="p">));</span>
<span class="w">            </span><span class="n">dao</span><span class="p">.</span><span class="na">delete</span><span class="p">(</span><span class="n">contactId</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">NumberFormatException</span><span class="w"> </span><span class="n">ex</span><span class="p">){</span>
<span class="w">            </span><span class="n">ex</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">resp</span><span class="p">.</span><span class="na">sendRedirect</span><span class="p">(</span><span class="s">&quot;pages/list-contact.jsp&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Itt is érdemes megjegyezni, hogy a kontakt kitörlése az összes hozzátartozó telefonszámot is kitörli.
További feladatként hozzáadhatunk egy megerősítést a törléshez, de ezen a ponton ezzel most nem foglalkozunk.</p>

  <hr>
<div class="md-source-file">
  <small>
    
      Utolsó frissítés:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_datetime">2024-03-19 07:21:59</span>
      
    
  </small>
</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2004-2024 Szegedi Tudományegyetem, Informatikai Intézet, Szoftverfejlesztés Tanszék
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/index.html" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["tabs"], "search": "../../assets/javascripts/workers/search.db81ec45.min.js", "translations": {"clipboard.copied": "V\u00e1g\u00f3lapra m\u00e1solva", "clipboard.copy": "M\u00e1sol\u00e1s v\u00e1g\u00f3lapra", "search.result.more.one": "1 tov\u00e1bbi tal\u00e1lat az oldalon", "search.result.more.other": "# tov\u00e1bbi tal\u00e1lat az oldalon", "search.result.none": "Nincs tal\u00e1lat", "search.result.one": "1 egyez\u0151 dokumentum", "search.result.other": "# egyez\u0151 dokumentum", "search.result.placeholder": "Keres\u00e9shez \u00edrj ide valamit", "search.result.term.missing": "\u00dcres", "select.version": "Verzi\u00f3v\u00e1lt\u00e1s"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.a00a7c5e.min.js"></script>
      
        <script src="../../js/main.js"></script>
      
    
  </body>
</html>