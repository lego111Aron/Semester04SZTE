
<!doctype html>
<html lang="hu" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../05_gyakorlat/index.html">
      
      
        <link rel="next" href="../06_kivonat/index.html">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.9">
    
    
      
        <title>6. gyakorlat (Web API) - Alkalmazásfejlesztés I. gyakorlat</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0d440cfe.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,300i,400,400i,700,700i%7CUbuntu+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Ubuntu";--md-code-font:"Ubuntu Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="Indigo" data-md-color-accent="Indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#6-gyakorlat-web-api" class="md-skip">
          Kihagyás
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Élőfej">
    <a href="../index.html" title="Alkalmazásfejlesztés I. gyakorlat" class="md-header__button md-logo" aria-label="Alkalmazásfejlesztés I. gyakorlat" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 3 1 9l11 6 9-4.91V17h2V9M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Alkalmazásfejlesztés I. gyakorlat
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              6. gyakorlat (Web API)
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Keresés" placeholder="Keresés" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Keresés">
        
        <button type="reset" class="md-search__icon md-icon" title="Törlés" aria-label="Törlés" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Keresés inicializálása
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigáció" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Alkalmazásfejlesztés I. gyakorlat" class="md-nav__button md-logo" aria-label="Alkalmazásfejlesztés I. gyakorlat" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 3 1 9l11 6 9-4.91V17h2V9M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82Z"/></svg>

    </a>
    Alkalmazásfejlesztés I. gyakorlat
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
      
      
      
        <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
          Általános
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Általános
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        Kezdőlap
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../00_Kovetelmenyek/index.html" class="md-nav__link">
        Követelmények
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Jegyzet
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Jegyzet
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../01_gyakorlat/index.html" class="md-nav__link">
        1. gyakorlat (XML + Maven)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../02_gyakorlat/index.html" class="md-nav__link">
        2. gyakorlat (Alap JavaFX elemek)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../03_gyakorlat/index.html" class="md-nav__link">
        3. gyakorlat (Táblázat kezelés)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../04_gyakorlat/index.html" class="md-nav__link">
        4. gyakorlat (FXML)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../05_gyakorlat/index.html" class="md-nav__link">
        5. gyakorlat (DAO)
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          6. gyakorlat (Web API)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./index.html" class="md-nav__link md-nav__link--active">
        6. gyakorlat (Web API)
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tartalomjegyzék">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tartalomjegyzék
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#packing" class="md-nav__link">
    Packing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#projekt-kezdese" class="md-nav__link">
    Projekt kezdése
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#servlet-kontener" class="md-nav__link">
    Servlet konténer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modellek" class="md-nav__link">
    Modellek
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#servletek" class="md-nav__link">
    Servletek
  </a>
  
    <nav class="md-nav" aria-label="Servletek">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#teapot" class="md-nav__link">
    Teapot
  </a>
  
    <nav class="md-nav" aria-label="Teapot">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request" class="md-nav__link">
    Request
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read" class="md-nav__link">
    Read
  </a>
  
    <nav class="md-nav" aria-label="Read">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note" class="md-nav__link">
    ! Note !
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request_1" class="md-nav__link">
    Request
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create" class="md-nav__link">
    Create
  </a>
  
    <nav class="md-nav" aria-label="Create">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request_2" class="md-nav__link">
    Request
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update" class="md-nav__link">
    Update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request_3" class="md-nav__link">
    Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete" class="md-nav__link">
    Delete
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request_4" class="md-nav__link">
    Request
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#servlet-context" class="md-nav__link">
    Servlet context
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#json-string-kezeles" class="md-nav__link">
    JSON string kezelés
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#viszonykovetes-sutik" class="md-nav__link">
    Viszonykövetés, sütik
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core" class="md-nav__link">
    Core
  </a>
  
    <nav class="md-nav" aria-label="Core">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dao" class="md-nav__link">
    DAO
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jooq" class="md-nav__link">
    jOOQ
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#system" class="md-nav__link">
    System
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../06_kivonat/index.html" class="md-nav__link">
        Web API kivonat
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../misc/generics/index.html" class="md-nav__link">
        Extra - Java Generikusok
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../misc/lambda/index.html" class="md-nav__link">
        Extra - Lambda kifejezések
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../misc/troubleshoot/index.html" class="md-nav__link">
        Troubleshoot
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Régi anyag
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Régi anyag
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../legacy/01_gyakorlat/index.html" class="md-nav__link">
        1. gyakorlat
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../legacy/02_gyakorlat/index.html" class="md-nav__link">
        2. gyakorlat
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../legacy/03_gyakorlat/index.html" class="md-nav__link">
        3. gyakorlat
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../legacy/04_gyakorlat/index.html" class="md-nav__link">
        4. gyakorlat
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../legacy/05_gyakorlat/index.html" class="md-nav__link">
        5. gyakorlat
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../legacy/06_gyakorlat/index.html" class="md-nav__link">
        6. gyakorlat
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../legacy/07_gyakorlat/index.html" class="md-nav__link">
        7. gyakorlat
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../legacy/08_gyakorlat/index.html" class="md-nav__link">
        8. gyakorlat
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../legacy/09_gyakorlat/index.html" class="md-nav__link">
        9. gyakorlat
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../legacy/10_gyakorlat/index.html" class="md-nav__link">
        10. gyakorlat
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../legacy/11_gyakorlat/index.html" class="md-nav__link">
        11. gyakorlat
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../legacy/12_gyakorlat/index.html" class="md-nav__link">
        12. gyakorlat
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../legacy/13_gyakorlat/index.html" class="md-nav__link">
        13. gyakorlat
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tartalomjegyzék">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tartalomjegyzék
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#packing" class="md-nav__link">
    Packing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#projekt-kezdese" class="md-nav__link">
    Projekt kezdése
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#servlet-kontener" class="md-nav__link">
    Servlet konténer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modellek" class="md-nav__link">
    Modellek
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#servletek" class="md-nav__link">
    Servletek
  </a>
  
    <nav class="md-nav" aria-label="Servletek">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#teapot" class="md-nav__link">
    Teapot
  </a>
  
    <nav class="md-nav" aria-label="Teapot">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request" class="md-nav__link">
    Request
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#read" class="md-nav__link">
    Read
  </a>
  
    <nav class="md-nav" aria-label="Read">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note" class="md-nav__link">
    ! Note !
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request_1" class="md-nav__link">
    Request
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create" class="md-nav__link">
    Create
  </a>
  
    <nav class="md-nav" aria-label="Create">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#request_2" class="md-nav__link">
    Request
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update" class="md-nav__link">
    Update
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request_3" class="md-nav__link">
    Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete" class="md-nav__link">
    Delete
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request_4" class="md-nav__link">
    Request
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#servlet-context" class="md-nav__link">
    Servlet context
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#json-string-kezeles" class="md-nav__link">
    JSON string kezelés
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#viszonykovetes-sutik" class="md-nav__link">
    Viszonykövetés, sütik
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core" class="md-nav__link">
    Core
  </a>
  
    <nav class="md-nav" aria-label="Core">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dao" class="md-nav__link">
    DAO
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jooq" class="md-nav__link">
    jOOQ
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#system" class="md-nav__link">
    System
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="6-gyakorlat-web-api">6. gyakorlat - WEB API<a class="headerlink" href="#6-gyakorlat-web-api" title="Permanent link">&para;</a></h1>
<p>A következő anyagrészek során Java servletekkel ismerkedhetünk meg. Itt fogunk némi betekintést nyerni abba,
hogy hogyan is rakhatunk össze egy egyszerűbb webes API-t. Modernebb rendszerek használata esetén, mint pl. egy
<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/web.html">Spring Boot Web MVC Framework</a>, már sok itt
látott dolog automatizálható, és nem kell foglalkozzunk vele, azonban ahhoz, hogy nagyjából megérthessük mi történik
ott, ahhoz nem árt egy kicsit alacsonyabb szintű rendszerekkel is foglalkozni egy rövid ideig.</p>
<p>Eddigi projektünket követve egy utazások és látnivalók felvételére készült alkalmazás fogunk elkészíteni.</p>
<h2 id="packing">Packing<a class="headerlink" href="#packing" title="Permanent link">&para;</a></h2>
<p>Webes alkalmazás esetén ügyeljünk rá, hogy az alkalmazásunk <code>war</code> csomagolási kiterjesztésű legyen.
Ezt a projektünk pom fájljában adhatjuk meg a következő módon:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">&lt;packaging&gt;</span>war<span class="nt">&lt;/packaging&gt;</span>
</code></pre></div></td></tr></table></div>
<p>ahol war = Web Application Archive.</p>
<p>Mivel jelenlegi alkalmazásunk egy annak megfelelő <em>servlet</em> konténerben fog futni,
így ennek megfelelő csomagolást választunk neki, ez a war.</p>
<p>A <a href="https://maven.apache.org/pom.html#packaging"><packing\/> tag</a>-et ugyanarra a szintre kell elhelyezzük,
mint akár a <code>&lt;groupId/&gt;</code>-t, vagy az <code>&lt;artifactId&gt;</code>-t.
További referenciákért bátran látogassunk el a https://maven.apache.org/pom.html oldalra.</p>
<h2 id="projekt-kezdese">Projekt kezdése<a class="headerlink" href="#projekt-kezdese" title="Permanent link">&para;</a></h2>
<p>Több mint valószínű, hogy sok-sok kiindulási template közül választhatnánk, mikor új webes projektet kezdünk,
viszont ezek többsége mára már sajnos vagy függőség, vagy webtechnológia szintjén elavultabbá vált, így
itt most egyiket sem fogjuk választani, összeszedjük magunknak, ami kell.</p>
<p>Webes applikációnkhoz készítsünk egy lehetőleg elkülönülő modult a következőképpen:</p>
<p><img alt="new-project-hi" src="../img/webapi-2024/new-project-hi.png" /></p>
<p>Fontos, hogy válasszuk ki a megfelelő <code>Parent</code> attribútumot, valamint a <code>groupId</code>-t is úgy válasszuk meg, hogy az
egyezzen a szülő package group azonosítójával (ha jót akarunk).</p>
<h2 id="servlet-kontener">Servlet konténer<a class="headerlink" href="#servlet-kontener" title="Permanent link">&para;</a></h2>
<p>Jelen használt servlet konténerünk egy egyszerű <a href="https://tomcat.apache.org/whichversion.html">Apache Tomcat</a> lesz.
Röviden, egy olyan szoftverről van szó, amely
a <a href="https://projects.eclipse.org/projects/ee4j.jakartaee-platform">Jakarta EE platform</a>
által specifikált eszközhalmaz egy minimális részét implementálja/tartalmazza.
Erre majd a későbbiek során vissza térünk egy rövid pillanatra, de most elegendő egy rövid kitérőként tekinteni erre.</p>
<p>Fontosak lehetnek azonban a fenti linken található verziózások! Ha fejlesztés során olyan hibákkal találkozunk
futtatás közben, mint pl. egy <code>ClassNotFoundException</code>, akkor gondolhatunk arra, hogy talán elcsúsztunk a verziókkal.
Nagyon erős indikátor lehet erre a hibára, amennyiben implementációnk <code>javax.*</code> csomagokat használ, miközben a <code>tomcat</code>
verziónk pl. <code>==10.x</code>. Ebben az esetben ugyanis a tomcat implementáció már <code>jakarta.*</code> és NEM <code>javax.*</code> csomagokat keres.
De erről a fenti linkeken többet olvashatunk.</p>
<table>
<thead>
<tr>
<th>Servlet Spec</th>
<th>JSP Spec</th>
<th>EL Spec</th>
<th>WebSocket Spec</th>
<th>Authentication (JASPIC) Spec</th>
<th>Apache Tomcat Version</th>
<th>Latest Released Version</th>
<th>Supported Java Versions</th>
</tr>
</thead>
<tbody>
<tr>
<td>6.1</td>
<td>4.0</td>
<td>6.0</td>
<td>2.2</td>
<td>3.1</td>
<td>11.0.x</td>
<td>11.0.0-M18 (alpha)</td>
<td>17 and later</td>
</tr>
<tr>
<td>6.0</td>
<td>3.1</td>
<td>5.0</td>
<td>2.1</td>
<td>3.0</td>
<td>10.1.x</td>
<td>10.1.20</td>
<td>11 and later</td>
</tr>
<tr>
<td>5.0</td>
<td>3.0</td>
<td>4.0</td>
<td>2.0</td>
<td>2.0</td>
<td>10.0.x (superseded)</td>
<td>10.0.27 (superseded)</td>
<td>8 and later</td>
</tr>
<tr>
<td>4.0</td>
<td>2.3</td>
<td>3.0</td>
<td>1.1</td>
<td>1.1</td>
<td>9.0.x</td>
<td>9.0.87</td>
<td>8 and later</td>
</tr>
<tr>
<td>3.1</td>
<td>2.3</td>
<td>3.0</td>
<td>1.1</td>
<td>1.1</td>
<td>8.5.x</td>
<td>8.5.100</td>
<td>7 and later</td>
</tr>
<tr>
<td>3.1</td>
<td>2.3</td>
<td>3.0</td>
<td>1.1</td>
<td>N/A</td>
<td>8.0.x (superseded)</td>
<td>8.0.53 (superseded)</td>
<td>7 and later</td>
</tr>
<tr>
<td>3.0</td>
<td>2.2</td>
<td>2.2</td>
<td>1.1</td>
<td>N/A</td>
<td>7.0.x (archived)</td>
<td>7.0.109 (archived)</td>
<td>6 and later (7 and later for WebSocket)</td>
</tr>
<tr>
<td>2.5</td>
<td>2.1</td>
<td>2.1</td>
<td>N/A</td>
<td>N/A</td>
<td>6.0.x (archived)</td>
<td>6.0.53 (archived)</td>
<td>5 and later</td>
</tr>
<tr>
<td>2.4</td>
<td>2.0</td>
<td>N/A</td>
<td>N/A</td>
<td>N/A</td>
<td>5.5.x (archived)</td>
<td>5.5.36 (archived)</td>
<td>1.4 and later</td>
</tr>
<tr>
<td>2.3</td>
<td>1.2</td>
<td>N/A</td>
<td>N/A</td>
<td>N/A</td>
<td>4.1.x (archived)</td>
<td>4.1.40 (archived)</td>
<td>1.3 and later</td>
</tr>
<tr>
<td>2.2</td>
<td>1.1</td>
<td>N/A</td>
<td>N/A</td>
<td>N/A</td>
<td>3.3.x (archived)</td>
<td>3.3.2 (archived)</td>
<td>1.1 and later</td>
</tr>
</tbody>
</table>
<p>A felhasználhatóság kedvéért a linken található táblázat itt is megjelenik, ám ezt csak óvatosan használjuk!
Az írás pillanatában a <code>Tomcat 11.x</code>-es szoftver még erősen fejlesztés alatt áll, ezért a specifikációk változhatnak,
míg az itt található táblázat nem feltétlenül fog!</p>
<p>Ahhoz, hogy legyen egy ilyen konténerünk, többféleképpen is eljárhatunk.
Régebbi gyakorlatokhoz hasonlóan segíthet ebben egy elég széleskörűen használt plugin,
amely egy beágyazott <code>tomcat</code> szervert fog futtatni számunkra.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">&lt;plugin&gt;</span>
<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>org.codehaus.cargo<span class="nt">&lt;/groupId&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>cargo-maven3-plugin<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">    </span><span class="nt">&lt;configuration&gt;</span>
<span class="w">        </span><span class="cm">&lt;!-- most egy beágyazott, v10 tomcat-et használunk --&gt;</span>
<span class="w">        </span><span class="nt">&lt;container&gt;</span>
<span class="w">            </span><span class="nt">&lt;containerId&gt;</span>tomcat10x<span class="nt">&lt;/containerId&gt;</span>
<span class="w">            </span><span class="nt">&lt;type&gt;</span>embedded<span class="nt">&lt;/type&gt;</span>
<span class="w">        </span><span class="nt">&lt;/container&gt;</span>
<span class="w">        </span><span class="nt">&lt;configuration&gt;</span>
<span class="w">            </span><span class="nt">&lt;properties&gt;</span>
<span class="w">                </span><span class="cm">&lt;!-- fusson a 8080-as porton! --&gt;</span>
<span class="w">                </span><span class="nt">&lt;cargo.servlet.port&gt;</span>8080<span class="nt">&lt;/cargo.servlet.port&gt;</span>
<span class="w">                </span><span class="cm">&lt;!-- low, medium vagy high --&gt;</span>
<span class="w">                </span><span class="nt">&lt;cargo.logging&gt;</span>medium<span class="nt">&lt;/cargo.logging&gt;</span>
<span class="w">            </span><span class="nt">&lt;/properties&gt;</span>
<span class="w">        </span><span class="nt">&lt;/configuration&gt;</span>
<span class="w">        </span><span class="nt">&lt;deployables&gt;</span>
<span class="w">            </span><span class="nt">&lt;deployable&gt;</span>
<span class="w">                </span><span class="nt">&lt;groupId&gt;</span>${project.groupId}<span class="nt">&lt;/groupId&gt;</span>
<span class="w">                </span><span class="nt">&lt;artifactId&gt;</span>${project.artifactId}<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">                </span><span class="nt">&lt;type&gt;</span>${project.packaging}<span class="nt">&lt;/type&gt;</span>
<span class="w">                </span><span class="nt">&lt;properties&gt;</span>
<span class="w">                    </span><span class="cm">&lt;!-- ez azért jó, mert így nem lesz mindenféle default útvonal beállítva --&gt;</span>
<span class="w">                    </span><span class="nt">&lt;context&gt;</span>/<span class="nt">&lt;/context&gt;</span>
<span class="w">                </span><span class="nt">&lt;/properties&gt;</span>
<span class="w">            </span><span class="nt">&lt;/deployable&gt;</span>
<span class="w">        </span><span class="nt">&lt;/deployables&gt;</span>
<span class="w">    </span><span class="nt">&lt;/configuration&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</code></pre></div></td></tr></table></div>
<p>Nincs szükség külön tomcat szerver telepítésére, mára már teljesen jó és kijárt utak vannak standalone
<em>webservice</em>-k készítésére. A gyakorlat során valószínűleg ez elegendő, és kényelmesebb is lehet.
Amennyiben életutunk során szükségünk lenne egy külső szerverre való alkalmazás deploy-ra, úgy
ellátogathatunk a régi gyakorlati részekhez.</p>
<p>Pluginok használatára már láttunk példát, evvel is hasonlóképp futtathatjuk alkalmazásunkat,
mint egy <code>javafx</code> alkalmazás esetén.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>./mvnw<span class="w"> </span>cargo:run
</code></pre></div></td></tr></table></div>
<p>avagy a projekten belül:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>./mvnw<span class="w"> </span>install<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>./mvnw<span class="w"> </span>cargo:run<span class="w"> </span>-pl<span class="w"> </span>webapi
</code></pre></div></td></tr></table></div>
<p>parancs segítségével futtathatjuk.</p>
<p>Térjünk rá ezután egy könnyebb útra, az alkalmazásunk indításához. Itt megjegyezzük,
hogy ezen gyakorlatnak nem célja megismertetni a Spring Framework-öt, és annak csodáit,
viszont a webapplikációnk indításához egy igen kellemes eszköz lehet.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@ServletComponentScan</span>
<span class="nd">@SpringBootApplication</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">App</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">SpringApplication</span><span class="p">(</span><span class="n">App</span><span class="p">.</span><span class="na">class</span><span class="p">).</span><span class="na">run</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Egy ilyen - effektíve egy soros - <code>Main</code> class segítségével bármely számunkra kedves IDE
használatával is indíthatjuk alkalmazásunkat.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">&lt;dependency&gt;</span>
<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">    </span><span class="nt">&lt;version&gt;</span>3.2.4<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>org.apache.tomcat.embed<span class="nt">&lt;/groupId&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>tomcat-embed-core<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">    </span><span class="nt">&lt;version&gt;</span>10.1.20<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></td></tr></table></div>
<p>Ehhez erre a két függőségre van szükségünk. Az elsőre a Spring Boot miatt, a másodikra a beágyazott Tomcat
szerver miatt, melyet a keretrendszerünk ebben az esetben elindít számunkra. Egy beágyazott Tomcat szerver
indítása nem túl veszélyes feladat, viszont jelenlegi gyakorlati anyagunk erre most nem terjed ki,
így marad a plugin, vagy egy Spring Boot.</p>
<h2 id="modellek">Modellek<a class="headerlink" href="#modellek" title="Permanent link">&para;</a></h2>
<p>A teljesség igénye nélkül, itt most megjelenítünk egy pár megvalósítás szempontjából fontosabb
modell osztályt, melyek szükségesek lehetnek az API pontokkal való kommunikációhoz.</p>
<p>A konkrét utazások reprezentációjára szolgáló objektumok:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="nd">@ToString</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Sight</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">price</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">openingHour</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">closingHour</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">description</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">popularity</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<p>Egy create operáció után adott válasz formátuma:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">InsertId</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<p>Ebben az esetben az <code>Object</code>, mint ID minden esetben <code>Long</code> típusú lesz, de meghagytuk a lehetőséget
esetlegesen más típusú elsődleges kulcsoknak is.</p>
<hr />
<p>Adatbázis módosítás után adott válasz (Update, vagy Delete).</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">ModifiedRows</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">affectedRows</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<p>Egyes preferenciák beállítására szolgáló kérés formátuma.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">Preferences</span><span class="p">(</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">minPrice</span><span class="p">,</span>
<span class="w">        </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">maxPrice</span><span class="p">,</span>
<span class="w">        </span><span class="n">Integer</span><span class="w"> </span><span class="n">minPopularity</span><span class="p">)</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Serializable</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">record</span> <span class="nc">Message</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">message</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="servletek">Servletek<a class="headerlink" href="#servletek" title="Permanent link">&para;</a></h2>
<p>A Java Servletek valamilyen féle alkalmazás-szerveren futó programok, melyeket egy köztes rétegként képzelhetünk el
kliensek kérései (pl. HTTP), valamint alkalmazásunk/alkalmazásaink között.</p>
<p>Servleteink során a következő <code>import</code>-okat szinte biztosan használni fogjuk:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.servlet.ServletConfig</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.servlet.annotation.WebServlet</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.servlet.http.HttpServlet</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.servlet.http.HttpServletRequest</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jakarta.servlet.http.HttpServletResponse</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>Ők a következő függőségtől származnak:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">&lt;dependency&gt;</span>
<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>jakarta.servlet<span class="nt">&lt;/groupId&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>jakarta.servlet-api<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">    </span><span class="nt">&lt;version&gt;</span>6.0.0<span class="nt">&lt;/version&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- Figyeljük meg a függőség scope-ját! --&gt;</span>
<span class="w">    </span><span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></td></tr></table></div>
<p>Ennél a pontnál kalandozzunk vissza az előző részek <a href="#servlet-konténer">tartalmához</a>.
Említettük, hogy az alkalmazásunkat futtató servlet konténer (jelenleg Tomcat) implementál
bizonyos specifikációkat. Adott konténer kiválasztása esetén a fejlesztő felelőssége,
hogy utánajárjon annak, hogy a Jakarta EE specifikációk közül melyek azok, amelyeket
tartalmaz a választott szoftver.
A provided scope annyit mond most itt nekünk, hogy az evvel járó csomagokat elegendő
fordítási időben behúzni, ugyanis ez majd a futás során valahonnan elérhető lesz. Ez
a valahonnan jelenleg a Tomcat szoftvertől lesz, ő fogja biztosítani nekünk a szükséges
jakarta osztályokat.</p>
<p>Kezdetben vegyük például egy egyszerű servlet elkészítését.</p>
<h3 id="teapot">Teapot<a class="headerlink" href="#teapot" title="Permanent link">&para;</a></h3>
<p>Egy teás kanna!</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// Ez egy fontos annotáció, ugyanis ennek segítségével</span>
<span class="c1">// specifikálhatjuk, hogy milyen útvonalon fog élni az</span>
<span class="c1">// adott servletünk. Ha a HOST után, (bármely kedvenc</span>
<span class="c1">// http kliensünket (vagy itt most épp akár böngészőnket)</span>
<span class="c1">// használva) az itt leírt útvonalat adjuk meg, akkor ez</span>
<span class="c1">// a servlet fog reagálni a kéréseinkre.</span>
<span class="nd">@WebServlet</span><span class="p">(</span><span class="n">urlPatterns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;/teapot&quot;</span><span class="p">)</span>
<span class="c1">// Az is nagyon fontos továbbá, hogy osztályunk a HttpServlet</span>
<span class="c1">// class-ból öröklődjön.</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TeapotServlet</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">HttpServlet</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// Itt a GET kérésekre való reagálási hajlamát adhatjuk meg</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doGet</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">resp</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Megadjuk a válasz formátumát. Most pl. text/html, de</span>
<span class="w">        </span><span class="c1">// ebben az esetben lehetne text/plain is. Van még jó sok,</span>
<span class="w">        </span><span class="c1">// nézzük meg őket!</span>
<span class="w">        </span><span class="n">resp</span><span class="p">.</span><span class="na">setContentType</span><span class="p">(</span><span class="n">ContentType</span><span class="p">.</span><span class="na">TEXT_HTML</span><span class="p">.</span><span class="na">getMimeType</span><span class="p">());</span>
<span class="w">        </span><span class="c1">// Nem kötelező, de specifikálhatjuk a karakter kódolást is.</span>
<span class="w">        </span><span class="n">resp</span><span class="p">.</span><span class="na">setCharacterEncoding</span><span class="p">(</span><span class="n">StandardCharsets</span><span class="p">.</span><span class="na">UTF_8</span><span class="p">.</span><span class="na">name</span><span class="p">());</span>

<span class="w">        </span><span class="c1">// Itt ez most egy teapot status. Általában OK == 200,</span>
<span class="w">        </span><span class="c1">// vagy hasonlókat fogunk inkább látni.</span>
<span class="w">        </span><span class="c1">// https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/418</span>
<span class="w">        </span><span class="n">resp</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="mi">418</span><span class="p">);</span><span class="w">  </span><span class="c1">// Nincs beépített teapot válasz :(</span>
<span class="w">        </span><span class="c1">// megfogjuk a response writer-t</span>
<span class="w">        </span><span class="c1">// aztán írunk vele valami választ</span>
<span class="w">        </span><span class="c1">// most csak annyit, hogy teapot vagyok</span>
<span class="w">        </span><span class="n">resp</span><span class="p">.</span><span class="na">getWriter</span><span class="p">().</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;I am a teapot&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>A gyakorlat során főként <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/POST">POST</a> kérésekkel fogunk
foglalkozni. Bizonyos esetekben akár használhatnánk <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/GET">GET</a>
kéréseket is, azonban nem igazán akarunk olyan kéréseket tervezni, melyeknek fontos lenne a cache-elése, továbbá
amennyiben kiegészítenénk az alkalmazásunkat olyan módon, hogy az valamilyen féle autentikációt is tartalmazzon,
úgy megint csak oda jutnánk, hogy az egyes API endpoint-okat <code>POST</code> kérésekkel kellene megvalósítsuk.</p>
<p>Ilyen módon diplomatikusabb tehát, ha maradunk a <code>POST</code> kéréseknél.
A fenti egyszerű esetben viszont, mivel olyanféle <em>view</em> adatokat közlünk a klienssel,
így már inkább indokolt egy <code>GET</code> request használata.</p>
<hr />
<h4 id="request">Request<a class="headerlink" href="#request" title="Permanent link">&para;</a></h4>
<p>És hogy ezt hogyan is érjük el? Próbáljuk ki először egy kissé fapados módon!
A következőkben, és itt is feltételezzük, hogy az alkalmazásunk a 8080-as porton fut.</p>
<p>Példa cURL segítségével a teapot servlet-hez:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>curl<span class="w"> </span>http://localhost:8080/teapot
</code></pre></div></td></tr></table></div>
<p>ugyanez fetch api használatával:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nx">fetch</span><span class="p">(</span><span class="s2">&quot;http://localhost:8080/teapot&quot;</span>
<span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">resp</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">text</span><span class="p">();</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="p">})</span>
</code></pre></div></td></tr></table></div>
<h3 id="read">Read<a class="headerlink" href="#read" title="Permanent link">&para;</a></h3>
<p>Készítsük el elsőre a feladatunkhoz tartozó első servletként, a read servletet.
Őt arra fogjuk használni, hogy az éppen megvalósított perzisztens tárhelytől adatokat kérjünk le.
Mint a többi servlet megvalósítását, ezt is érdemes egy külön, pl. <code>servlet</code> csomag alá helyezni.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// Jelen servletünk több URL-t is elfogad, read és list alias alatt is hívhatjuk.</span>
<span class="nd">@WebServlet</span><span class="p">(</span><span class="n">urlPatterns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;/api/sight/read&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/api/sight/list&quot;</span><span class="p">})</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SightReadServlet</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">HttpServlet</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// data access object, mellyel az utazásainkat kezelhetjük</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Dao</span><span class="o">&lt;</span><span class="n">Long</span><span class="p">,</span><span class="w"> </span><span class="n">Sight</span><span class="o">&gt;</span><span class="w"> </span><span class="n">dao</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// opcionális</span>
<span class="w">    </span><span class="c1">// validációra szolgáló factory, mely validációt kézzel is elvégezhetünk</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">ValidatorFactory</span><span class="w"> </span><span class="n">validatorFactory</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// egy opcionális logger</span>
<span class="w">    </span><span class="c1">// nem feltétele egy működő servletnek</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Logger</span><span class="w"> </span><span class="n">logger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">getClass</span><span class="p">());</span>

<span class="w">    </span><span class="c1">// Az init metódus most nekünk csak a DataSource beszerzése miatt fontos,</span>
<span class="w">    </span><span class="c1">// azonban ebben a példában itt most található egy validátor is.</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">init</span><span class="p">(</span><span class="n">ServletConfig</span><span class="w"> </span><span class="n">config</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Honnan jön ez itt??? Később látni fogjuk!</span>
<span class="w">        </span><span class="c1">// Itt természetesen elegendő lehetne egy singleton-tól elkérni ezt,</span>
<span class="w">        </span><span class="c1">// de ha hosszútávon jót akarunk magunknak, akkor singleton-t csak akkor</span>
<span class="w">        </span><span class="c1">// alkalmazunk ha abszolút muszáj, vagy indokolt.</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">dataSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">DataSource</span><span class="p">)</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="na">getServletContext</span><span class="p">().</span><span class="na">getAttribute</span><span class="p">(</span><span class="s">&quot;ds&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">dao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SightJooqDao</span><span class="p">(</span><span class="n">dataSource</span><span class="p">,</span><span class="w"> </span><span class="n">SQLDialect</span><span class="p">.</span><span class="na">SQLITE</span><span class="p">);</span>
<span class="w">        </span><span class="n">validatorFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ValidatorFactory</span><span class="p">)</span><span class="w"> </span><span class="n">config</span><span class="p">.</span><span class="na">getServletContext</span><span class="p">().</span><span class="na">getAttribute</span><span class="p">(</span><span class="s">&quot;val&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doPost</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">resp</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Adott metódusaink belépésekor rögtön specifikálhatjuk is a válaszunk formátumát!</span>
<span class="w">        </span><span class="n">resp</span><span class="p">.</span><span class="na">setContentType</span><span class="p">(</span><span class="n">ContentType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">.</span><span class="na">getMimeType</span><span class="p">());</span>
<span class="w">        </span><span class="c1">// állíthatunk karakter kódolást is --&gt; pl. UTF-8</span>
<span class="w">        </span><span class="n">resp</span><span class="p">.</span><span class="na">setCharacterEncoding</span><span class="p">(</span><span class="n">StandardCharsets</span><span class="p">.</span><span class="na">UTF_8</span><span class="p">.</span><span class="na">name</span><span class="p">());</span>
<span class="w">        </span><span class="c1">// Az alap státusz kódunk egy OK (200) lesz.</span>
<span class="w">        </span><span class="n">resp</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">SC_OK</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// kérünk egy json szerializáló példányt</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">gson</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JsonSupport</span><span class="p">.</span><span class="na">create</span><span class="p">();</span>
<span class="w">        </span><span class="c1">// beolvassuk a request body-t</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">reqModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gson</span><span class="p">.</span><span class="na">fromJson</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="na">getReader</span><span class="p">(),</span><span class="w"> </span><span class="n">ReadSightReq</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">validator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">validatorFactory</span><span class="p">.</span><span class="na">getValidator</span><span class="p">();</span>
<span class="w">        </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">ConstraintViolation</span><span class="o">&lt;</span><span class="n">ReadSightReq</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">valResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="w">        </span><span class="c1">// amennyiben van request model, úgy validáljuk azt</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">reqModel</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">valResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">validator</span><span class="p">.</span><span class="na">validate</span><span class="p">(</span><span class="n">reqModel</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// opcionális: logolás</span>
<span class="w">        </span><span class="n">valResult</span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">el</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">logger</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="n">ValidationLog</span><span class="p">.</span><span class="na">createLog</span><span class="p">(</span><span class="n">el</span><span class="p">)));</span>
<span class="w">        </span><span class="c1">// Amennyiben a validáció hibába, vagy hibákba ütközött, abban az esetben</span>
<span class="w">        </span><span class="c1">// szeretnénk ha a servlet pl. egy BAD_REQUEST (400) hibakóddal jelezné</span>
<span class="w">        </span><span class="c1">// problémáját. Amennyiben módunk van rá adhatunk némi információt is evvel</span>
<span class="w">        </span><span class="c1">// kapcsolatban, pl. egy error message formájában.</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">valResult</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">resp</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">SC_BAD_REQUEST</span><span class="p">);</span>
<span class="w">            </span><span class="n">resp</span><span class="p">.</span><span class="na">getWriter</span><span class="p">().</span><span class="na">println</span><span class="p">(</span><span class="n">gson</span><span class="p">.</span><span class="na">toJson</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Error</span><span class="p">(</span><span class="n">valResult</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                    </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">ValidationLog</span><span class="p">::</span><span class="n">createLog</span><span class="p">)</span>
<span class="w">                    </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">joining</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">)))));</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// Ha a kérés üres volt, akkor csak szimplán lekérjük az összes rekordot,</span>
<span class="w">        </span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Sight</span><span class="o">&gt;</span><span class="w"> </span><span class="n">models</span><span class="p">;</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">reqModel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">models</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// máskülönben pedig szűrünk az adott kérésben szereplő modell szerint.</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">models</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">findAllByCrit</span><span class="p">(</span><span class="n">ConversionSupport</span><span class="p">.</span><span class="na">toModel</span><span class="p">(</span><span class="n">reqModel</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">modelList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StreamSupport</span><span class="p">.</span><span class="na">stream</span><span class="p">(</span><span class="n">models</span><span class="p">.</span><span class="na">spliterator</span><span class="p">(),</span><span class="w"> </span><span class="kc">false</span><span class="p">).</span><span class="na">toList</span><span class="p">();</span>
<span class="w">        </span><span class="n">resp</span><span class="p">.</span><span class="na">getWriter</span><span class="p">().</span><span class="na">println</span><span class="p">(</span><span class="n">gson</span><span class="p">.</span><span class="na">toJson</span><span class="p">(</span><span class="n">modelList</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Megvalósított servleteink esetén talán az egyik legfontosabb lépés a válasz írása.
Itt és a következőkben egy egyszerűen használható, és népszerű json parser csomagot használunk:
<a href="https://github.com/google/gson">gson</a></p>
<p>További infókért nézzük meg a <a href="#json-string-kezelés">JSON</a> szekciót.</p>
<p>Ezen kívül látható egy <code>ContentType</code>, egy <code>HttpStatus</code>, valamint egy <code>StandardCharsets</code>
beállítás is. Az első kettő esetben a</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">&lt;dependency&gt;</span>
<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>org.apache.httpcomponents<span class="nt">&lt;/groupId&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>httpcore<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">    </span><span class="nt">&lt;version&gt;</span>4.4.16<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></td></tr></table></div>
<p>csomagot használtuk fel. A <code>HttpStatus</code> esetében használható a <code>jakarta.servlet-api</code> által szolgáltatott
<code>HttpServletResponse</code> is. Használatukat tekintve, a jelenlegi szempontjaink alapján egyezőnek tekinthetők, azonban
megjegyezzük, jelenleg csupán a kellemesebb olvashatóságot segítik elő (no magic variables), de érdemben
ekvivalensek egy beégetett számmal/stringgel.</p>
<h4 id="note">! Note !<a class="headerlink" href="#note" title="Permanent link">&para;</a></h4>
<p><img alt="dragon-danger" src="../img/webapi-2024/dragon-head-logo-sm.png" />
Itt nem győzzük hangsúlyozni, hogy a kért válaszok formátuma nagyon fontos API tervezése esetén.
Amennyiben ez eltér a megrendeléstől, úgy a ráépülő applikációk egyike sem fogja érteni a
szerver által küldött válaszokat, itt nincs "pardon". Ha egy adott API endpoint egy <code>alma</code> és
egy <code>kukac</code> mezőkkel rendelkező JSON-t vár, pl. <code>String</code> és <code>Integer</code> típusokat feltételezve,
akkor amennyiben nem olvasható az adott válasz ebben az adott formátumban, úgy az egész mehet a levesbe!</p>
<hr />
<h4 id="request_1">Request<a class="headerlink" href="#request_1" title="Permanent link">&para;</a></h4>
<p>Példa az összes rekord lekérésére:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>curl<span class="w"> </span>--request<span class="w"> </span>POST<span class="w"> </span>http://localhost:8080/api/sight/list
</code></pre></div></td></tr></table></div>
<p>Ugyanez szűréssel:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>curl<span class="w"> </span>--header<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span>--data<span class="w"> </span><span class="s1">&#39;{&quot;id&quot;: 3}&#39;</span><span class="w"> </span>--request<span class="w"> </span>POST<span class="w"> </span>http://localhost:8080/api/sight/list
</code></pre></div></td></tr></table></div>
<p>Fetch API:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nx">fetch</span><span class="p">(</span><span class="s2">&quot;http://localhost:8080/api/sight/list&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="s2">&quot;method&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;post&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="s2">&quot;body&quot;</span><span class="o">:</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;a&quot;</span><span class="p">}),</span>
<span class="w">  </span><span class="s2">&quot;headers&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;Content-Type&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="w"> </span><span class="p">}</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span>
<span class="w">  </span><span class="nx">resp</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">resp</span><span class="p">.</span><span class="nx">json</span><span class="p">()</span>
<span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">data</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="p">})</span>
</code></pre></div></td></tr></table></div>
<h3 id="create">Create<a class="headerlink" href="#create" title="Permanent link">&para;</a></h3>
<p>A create servletünk nagyon hasonló alapokra épül, mint akár a read, csupán a <code>doPost</code>
megvalósításában lesznek eltérések. Ezen kívül természetesen az is különböző lesz,
hogy milyen url-pattern alatt fogjuk elérni, melyet ne feledjünk el a megfelelő
annotáció segítségével beállítani. Ezen URL-ek esetünkben pl. lehetnek a következők:
<code>"/api/sight/create"</code>, <code>"/api/sight/insert"</code>, <code>"/api/sight/add"</code></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@Override</span>
<span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doPost</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">resp</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">resp</span><span class="p">.</span><span class="na">setContentType</span><span class="p">(</span><span class="n">ContentType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">.</span><span class="na">getMimeType</span><span class="p">());</span>
<span class="w">    </span><span class="n">resp</span><span class="p">.</span><span class="na">setCharacterEncoding</span><span class="p">(</span><span class="n">StandardCharsets</span><span class="p">.</span><span class="na">UTF_8</span><span class="p">.</span><span class="na">name</span><span class="p">());</span>
<span class="w">    </span><span class="n">resp</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">SC_CREATED</span><span class="p">);</span>

<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">gson</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JsonSupport</span><span class="p">.</span><span class="na">create</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// első különbség az elfogadott kérés típusában</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">reqModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gson</span><span class="p">.</span><span class="na">fromJson</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="na">getReader</span><span class="p">(),</span><span class="w"> </span><span class="n">NewSightReq</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">validator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">validatorFactory</span><span class="p">.</span><span class="na">getValidator</span><span class="p">();</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">valResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">validator</span><span class="p">.</span><span class="na">validate</span><span class="p">(</span><span class="n">reqModel</span><span class="p">);</span>

<span class="w">    </span><span class="n">valResult</span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">el</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">logger</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="n">ValidationLog</span><span class="p">.</span><span class="na">createLog</span><span class="p">(</span><span class="n">el</span><span class="p">)));</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">valResult</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">resp</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">SC_BAD_REQUEST</span><span class="p">);</span>
<span class="w">        </span><span class="n">resp</span><span class="p">.</span><span class="na">getWriter</span><span class="p">().</span><span class="na">println</span><span class="p">(</span><span class="n">gson</span><span class="p">.</span><span class="na">toJson</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Error</span><span class="p">(</span><span class="n">valResult</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">ValidationLog</span><span class="p">::</span><span class="n">createLog</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">joining</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">)))));</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// request modell átalakítása tényleges db modellé</span>
<span class="w">    </span><span class="c1">// gyakorlatilag a mezők megfelelő értékeinek másolása történik</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">dbModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ConversionSupport</span><span class="p">.</span><span class="na">toModel</span><span class="p">(</span><span class="n">reqModel</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// adott model tényleges mentése az adatbázisba</span>
<span class="w">    </span><span class="n">dao</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">dbModel</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// json konvertálás -&gt; &quot;{&quot;id&quot;: dbModel::id}&quot;</span>
<span class="w">    </span><span class="n">resp</span><span class="p">.</span><span class="na">getWriter</span><span class="p">().</span><span class="na">println</span><span class="p">(</span><span class="n">gson</span><span class="p">.</span><span class="na">toJson</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">InsertId</span><span class="p">(</span><span class="n">dbModel</span><span class="p">.</span><span class="na">getId</span><span class="p">())));</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Adott esetben akár be is olvashatnánk minden kérést egy adott osztályba, esetünkben a <code>Sight</code>
osztályba, azonban vegyük észre, hogy itt most egy <code>NewSightReq</code> típust használunk arra, hogy
a kliens kérését beolvassuk. Ez az osztály pl. a következőképpen nézhet ki:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="nd">@ToString</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">NewSightReq</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@NotBlank</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<span class="w">    </span><span class="nd">@PositiveOrZero</span>
<span class="w">    </span><span class="nd">@NotNull</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">price</span><span class="p">;</span>
<span class="w">    </span><span class="nd">@Min</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Max</span><span class="p">(</span><span class="mi">23</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@NotNull</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">openingHour</span><span class="p">;</span>
<span class="w">    </span><span class="nd">@Min</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Max</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@NotNull</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">closingHour</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">description</span><span class="p">;</span>
<span class="w">    </span><span class="nd">@Min</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@Max</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="w">    </span><span class="nd">@NotNull</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Integer</span><span class="w"> </span><span class="n">popularity</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Itt a <code>jakarta.validation-api</code>-t használjuk, mint függőség.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">&lt;dependency&gt;</span>
<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>jakarta.validation<span class="nt">&lt;/groupId&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>jakarta.validation-api<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">    </span><span class="nt">&lt;version&gt;</span>3.0.2<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></td></tr></table></div>
<p>Tárolásra és kérésre alkalmas osztályainkat nagyon sok esetben érdemes lehet szétválasztani.
Már csak azért is, mert egy kérés során (mint itt is) nem feltétlenül várjuk el ugyanazon
paramétereket. Továbbá a validációja is elkülönülhet annak, hogy mit tekintünk valid inputnak,
valamint annak is, hogy adatbázis mentéskor mit tekintünk egy érvényes rekordnak. Gondoljunk
például csak bele a <code>UNIQUE</code> megkötésekre. Ezt bevitelkor nem tudjuk, és nem is akarjuk
ellenőrizni, csupán a tényleges adatbázisba való mentés lépésekor.</p>
<hr />
<h4 id="request_2">Request<a class="headerlink" href="#request_2" title="Permanent link">&para;</a></h4>
<p>Példa egy create kérésre cURL használatával:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>curl<span class="w"> </span>-header<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span>--data<span class="w"> </span><span class="s1">&#39;{&quot;name&quot;: &quot;sth new&quot;, &quot;price&quot;: 93.15, &quot;openingHour&quot;: 6, &quot;closingHour&quot;: 18, &quot;description&quot;: &quot;A long description to show you how good this sight is.\nBe prepared!&quot;; &quot;popularity&quot;: 7}&#39;</span><span class="w"> </span>--request<span class="w"> </span>POST<span class="w"> </span>http://localhost:8080/api/sight/create
</code></pre></div></td></tr></table></div>
<h3 id="update">Update<a class="headerlink" href="#update" title="Permanent link">&para;</a></h3>
<p>Update esetén szinte ugyanaz történik, mint egy create esetén, csupán arra kell figyeljünk, hogy a
megengedett URL-eket ennek a servletnek megfelelően adjuk meg. Pl. <code>api/sight/update</code>, és/vagy
<code>api/sight/refresh</code> legyen.
Ezen kívül természetesen egy kicsit más, de nagyon hasonló a beolvasott kérés formátuma is, amely
itt most ténylegesen csak annyiban különbözik, hogy az <code>UpdateSightReq</code> class tartalmaz egy <code>id</code>
mezőt is. Továbbá szükséges még a megfelelő <code>dao::updateById</code> metódusát is meghívni.
Válaszunk pedig egy <code>affectedRows</code> nevű mezőt tartalmaz, mely a módosított rekordok számosságát
hivatott jelölni.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@Override</span>
<span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doPost</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">resp</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">resp</span><span class="p">.</span><span class="na">setContentType</span><span class="p">(</span><span class="n">ContentType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">.</span><span class="na">getMimeType</span><span class="p">());</span>
<span class="w">    </span><span class="n">resp</span><span class="p">.</span><span class="na">setCharacterEncoding</span><span class="p">(</span><span class="n">StandardCharsets</span><span class="p">.</span><span class="na">UTF_8</span><span class="p">.</span><span class="na">name</span><span class="p">());</span>
<span class="w">    </span><span class="n">resp</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">SC_OK</span><span class="p">);</span>

<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">gson</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JsonSupport</span><span class="p">.</span><span class="na">create</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// update request beolvasása</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">reqModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gson</span><span class="p">.</span><span class="na">fromJson</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="na">getReader</span><span class="p">(),</span><span class="w"> </span><span class="n">UpdateSightReq</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">validator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">validatorFactory</span><span class="p">.</span><span class="na">getValidator</span><span class="p">();</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">valResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">validator</span><span class="p">.</span><span class="na">validate</span><span class="p">(</span><span class="n">reqModel</span><span class="p">);</span>

<span class="w">    </span><span class="n">valResult</span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">el</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">logger</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="n">ValidationLog</span><span class="p">.</span><span class="na">createLog</span><span class="p">(</span><span class="n">el</span><span class="p">)));</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">valResult</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">resp</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">SC_BAD_REQUEST</span><span class="p">);</span>
<span class="w">        </span><span class="n">resp</span><span class="p">.</span><span class="na">getWriter</span><span class="p">().</span><span class="na">println</span><span class="p">(</span><span class="n">gson</span><span class="p">.</span><span class="na">toJson</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Error</span><span class="p">(</span><span class="n">valResult</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">ValidationLog</span><span class="p">::</span><span class="n">createLog</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">joining</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">)))));</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// request modell átalakítása tényleges db modellé</span>
<span class="w">    </span><span class="c1">// gyakorlatilag a mezők megfelelő értékeinek másolása történik</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">dbModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ConversionSupport</span><span class="p">.</span><span class="na">toModel</span><span class="p">(</span><span class="n">reqModel</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// db update</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">affectedRows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">updateById</span><span class="p">(</span><span class="n">reqModel</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span><span class="w"> </span><span class="n">dbModel</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// majd válasz írása</span>
<span class="w">    </span><span class="n">resp</span><span class="p">.</span><span class="na">getWriter</span><span class="p">().</span><span class="na">println</span><span class="p">(</span><span class="n">gson</span><span class="p">.</span><span class="na">toJson</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ModifiedRows</span><span class="p">(</span><span class="n">affectedRows</span><span class="p">)));</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Láthatjuk, hogy gondosabban megtervezett servletek esetén nagyon minimális változtatás
is elég lehet különböző funkciók megvalósításához. Ugyanakkor, ez jelen pillanatban másra
is adhat utalást. Vegyük észre, hogy ez a servlet, és az előzőek esetén is igaz, hogy
nagyon kevés tényleges funkcionalitással rendelkeznek egy ilyen egyszerű esetben.
Ha nagyon fapadosak akarunk lenni, akkor az egész <code>doPost</code> redukálható lenne a következő
<em>lényegi</em> sorokra:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@Override</span>
<span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doPost</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">resp</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">reqModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Gson</span><span class="p">().</span><span class="na">fromJson</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="na">getReader</span><span class="p">(),</span><span class="w"> </span><span class="n">UpdateSightReq</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">    </span><span class="n">resp</span><span class="p">.</span><span class="na">getWriter</span><span class="p">().</span><span class="na">println</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Gson</span><span class="p">().</span><span class="na">toJson</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ModifiedRows</span><span class="p">(</span>
<span class="w">            </span><span class="n">dao</span><span class="p">.</span><span class="na">updateById</span><span class="p">(</span><span class="n">reqModel</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span><span class="w"> </span><span class="n">ConversionSupport</span><span class="p">.</span><span class="na">toModel</span><span class="p">(</span><span class="n">reqModel</span><span class="p">)))));</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Ez elmondható a többi servletünkről is. Természetesen fontos a validáció, de ha esetleg hajlamot
éreznénk a részletekben való elveszéshez, akkor gondoljunk csak a fenti megvalósításra.</p>
<p>Gyakorlásképpen, és egy teljesen ideális világot feltételezve, írjuk át az összes eddigi servletet
ilyen módon!</p>
<hr />
<h3 id="request_3">Request<a class="headerlink" href="#request_3" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>curl<span class="w"> </span>-header<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span>--data<span class="w"> </span><span class="s1">&#39;{&quot;id&quot;: 3, &quot;name&quot;: &quot;change me&quot;, &quot;price&quot;: 24.42, &quot;openingHour&quot;: 12, &quot;closingHour&quot;: 20, &quot;description&quot;: &quot;Come here kind Sir!&quot;; &quot;popularity&quot;: 8}&#39;</span><span class="w"> </span>--request<span class="w"> </span>POST<span class="w"> </span>http://localhost:8080/api/sight/update
</code></pre></div></td></tr></table></div>
<h3 id="delete">Delete<a class="headerlink" href="#delete" title="Permanent link">&para;</a></h3>
<p>Delete esetében nem is időzünk már sokat, ő már tényleg szinte ugyanaz, mint egy update.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@Override</span>
<span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doPost</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">resp</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">resp</span><span class="p">.</span><span class="na">setContentType</span><span class="p">(</span><span class="n">ContentType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">.</span><span class="na">getMimeType</span><span class="p">());</span>
<span class="w">    </span><span class="n">resp</span><span class="p">.</span><span class="na">setCharacterEncoding</span><span class="p">(</span><span class="n">StandardCharsets</span><span class="p">.</span><span class="na">UTF_8</span><span class="p">.</span><span class="na">name</span><span class="p">());</span>
<span class="w">    </span><span class="n">resp</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">SC_OK</span><span class="p">);</span>

<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">gson</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JsonSupport</span><span class="p">.</span><span class="na">create</span><span class="p">();</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">reqModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gson</span><span class="p">.</span><span class="na">fromJson</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="na">getReader</span><span class="p">(),</span><span class="w"> </span><span class="n">DeleteSightReq</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">validator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">validatorFactory</span><span class="p">.</span><span class="na">getValidator</span><span class="p">();</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">valResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">validator</span><span class="p">.</span><span class="na">validate</span><span class="p">(</span><span class="n">reqModel</span><span class="p">);</span>

<span class="w">    </span><span class="n">valResult</span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">el</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">logger</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="n">ValidationLog</span><span class="p">.</span><span class="na">createLog</span><span class="p">(</span><span class="n">el</span><span class="p">)));</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">valResult</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">resp</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">SC_BAD_REQUEST</span><span class="p">);</span>
<span class="w">        </span><span class="n">resp</span><span class="p">.</span><span class="na">getWriter</span><span class="p">().</span><span class="na">println</span><span class="p">(</span><span class="n">gson</span><span class="p">.</span><span class="na">toJson</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Error</span><span class="p">(</span><span class="n">valResult</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">ValidationLog</span><span class="p">::</span><span class="n">createLog</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">joining</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">)))));</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">affectedRows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">deleteById</span><span class="p">(</span><span class="n">reqModel</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
<span class="w">    </span><span class="n">resp</span><span class="p">.</span><span class="na">getWriter</span><span class="p">().</span><span class="na">println</span><span class="p">(</span><span class="n">gson</span><span class="p">.</span><span class="na">toJson</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ModifiedRows</span><span class="p">(</span><span class="n">affectedRows</span><span class="p">)));</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<hr />
<h3 id="request_4">Request<a class="headerlink" href="#request_4" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code>curl<span class="w"> </span>-header<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span>--data<span class="w"> </span><span class="s1">&#39;{&quot;id&quot;: 3}&#39;</span><span class="w"> </span>--request<span class="w"> </span>POST<span class="w"> </span>http://localhost:8080/api/sight/delete
</code></pre></div></td></tr></table></div>
<h2 id="servlet-context">Servlet context<a class="headerlink" href="#servlet-context" title="Permanent link">&para;</a></h2>
<p>Történetünk elején láthattuk, hogy kaptunk egy pár ingyen <code>DataSource</code>, valamint
<code>ValidatorFactory</code> objektumot is. De honnan is jöttek ezek? Applikációnk indulásakor van
egy fontos event, melyre listener-t is köthetünk Ez pedig a
<a href="https://www.geeksforgeeks.org/servlet-context-event-and-context-listener/index.html">ServletContextListener::contextInitialized</a>
event. Egyéb event listenerekkel a gyakorlat során valószínűleg nem fogunk találkozni, de
röviden feladatuk annyiban ki is merül, hogy megfelelő eventekre specifikálhatunk velük egy
adott munkavégzési folyamatot. Azaz, "ha jön egy ilyen <em>event</em>, akkor hajtsd végre ezt az <em>action</em>-t".</p>
<p>Egy ilyen listener-t például a következőképpen implementálhatunk:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@WebListener</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ContextListener</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">ServletContextListener</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// ő lesz majd a DataSource objektumunk az alkalmazásunk pusztulásáig</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">DataSource</span><span class="w"> </span><span class="n">dataSource</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// szintén az alkalmazásunk végéig él, és a requestek validálásáért szolgál</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ValidatorFactory</span><span class="w"> </span><span class="n">validatorFactory</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">ContextListener</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// final mezők létrehozása</span>
<span class="w">        </span><span class="n">dataSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DataSourceFactory</span><span class="p">().</span><span class="na">getDataSource</span><span class="p">();</span>
<span class="w">        </span><span class="n">validatorFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Validation</span><span class="p">.</span><span class="na">buildDefaultValidatorFactory</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">contextInitialized</span><span class="p">(</span><span class="n">ServletContextEvent</span><span class="w"> </span><span class="n">sce</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">dbSupport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SqlDbSupport</span><span class="p">(</span><span class="n">dataSource</span><span class="p">);</span>
<span class="w">        </span><span class="c1">//var authSupport = new CookieAuthSupport(new AuthService(new UserJooqDao(dataSource, SQLDialect.SQLITE)), null, null);</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">authSupport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NopAuthenticator</span><span class="p">();</span>
<span class="w">        </span><span class="c1">// inicializálunk minden &quot;globális&quot; változót, ami csak kell</span>
<span class="w">        </span><span class="c1">// ezeket majd BÁRMELY servlet-ből elérhetjük</span>
<span class="w">        </span><span class="n">sce</span><span class="p">.</span><span class="na">getServletContext</span><span class="p">().</span><span class="na">setAttribute</span><span class="p">(</span><span class="s">&quot;ds&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">dataSource</span><span class="p">);</span>
<span class="w">        </span><span class="n">sce</span><span class="p">.</span><span class="na">getServletContext</span><span class="p">().</span><span class="na">setAttribute</span><span class="p">(</span><span class="s">&quot;auth&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">authSupport</span><span class="p">);</span>
<span class="w">        </span><span class="n">sce</span><span class="p">.</span><span class="na">getServletContext</span><span class="p">().</span><span class="na">setAttribute</span><span class="p">(</span><span class="s">&quot;val&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">validatorFactory</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// memory db init</span>
<span class="w">        </span><span class="n">dbSupport</span><span class="p">.</span><span class="na">createTablesIfNotExist</span><span class="p">();</span>
<span class="w">        </span><span class="n">dbSupport</span><span class="p">.</span><span class="na">insertIntoTables</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">contextDestroyed</span><span class="p">(</span><span class="n">ServletContextEvent</span><span class="w"> </span><span class="n">sce</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// amennyiben a DataSource closable, úgy zárjuk azt be</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">dataSource</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">dataSource</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">AutoCloseable</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="p">((</span><span class="n">AutoCloseable</span><span class="p">)</span><span class="w"> </span><span class="n">dataSource</span><span class="p">).</span><span class="na">close</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// micsoda??? valami eléggé félrement</span>
<span class="w">                </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">validatorFactory</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">validatorFactory</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Ez a class pedig mehet is egy <code>listener</code> package alá.</p>
<h2 id="json-string-kezeles">JSON string kezelés<a class="headerlink" href="#json-string-kezeles" title="Permanent link">&para;</a></h2>
<p>Ahhoz, hogy használhassuk a kiszemelt csomagunkat, először szeretnénk behúzni azt, mint függőség.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">&lt;dependency&gt;</span>
<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>com.google.code.gson<span class="nt">&lt;/groupId&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>gson<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">    </span><span class="nt">&lt;version&gt;</span>2.10.1<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></td></tr></table></div>
<p>A gson package segítségével objektumokat fogunk tudni egészen egyszerű módon JSON kompatibilis
stringekké konvertálni.</p>
<p>Például:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">class</span> <span class="nc">Message</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">msg</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">...</span>

<span class="k">new</span><span class="w"> </span><span class="n">Gson</span><span class="p">().</span><span class="na">toJson</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Message</span><span class="p">(</span><span class="s">&quot;hello there&quot;</span><span class="p">));</span>
<span class="c1">// &gt;&gt;</span>
<span class="c1">// &quot;{\&quot;msg\&quot;: \&quot;hello there\&quot;}&quot;</span>
</code></pre></div></td></tr></table></div>
<p>Természetesen előfordulhat, hogy olyan objektumokat is kell szerializálni,
melyeket alapból nem ismer a gson package. Ekkor lehetőségünk van létrehozni saját osztályokat,
melyek adott objektumok beolvasását, illetve kiírását végzik.</p>
<p>Lássunk erre példát alább egy egyszerű LocalDate esetén.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// Segítségével LocalDate objektumot fogunk egy egyszerű stringé alakítani.</span>
<span class="c1">// Az interface felülírandó metódusa a `serialize` lesz.</span>
<span class="kd">class</span> <span class="nc">LocalDateSerializer</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">JsonSerializer</span><span class="o">&lt;</span><span class="n">LocalDate</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">JsonElement</span><span class="w"> </span><span class="nf">serialize</span><span class="p">(</span><span class="n">LocalDate</span><span class="w"> </span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="n">Type</span><span class="w"> </span><span class="n">typeOfSrc</span><span class="p">,</span><span class="w"> </span><span class="n">JsonSerializationContext</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// a datetime stringek kövesék az ISO formátumot!</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">JsonPrimitive</span><span class="p">(</span><span class="n">date</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="n">DateTimeFormatter</span><span class="p">.</span><span class="na">ISO_LOCAL_DATE</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Segítségével LocalDate objektumot fogunk parsolni egy stringből.</span>
<span class="c1">// Az interface felülírandó metódusa a `deserialize`.</span>
<span class="kd">class</span> <span class="nc">LocalDateDeserializer</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">JsonDeserializer</span><span class="o">&lt;</span><span class="n">LocalDate</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">LocalDate</span><span class="w"> </span><span class="nf">deserialize</span><span class="p">(</span><span class="n">JsonElement</span><span class="w"> </span><span class="n">jsonElement</span><span class="p">,</span><span class="w"> </span><span class="n">Type</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">JsonDeserializationContext</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">JsonParseException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// json elem beolvasása stringként</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jsonElement</span><span class="p">.</span><span class="na">getAsString</span><span class="p">();</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">string</span><span class="p">.</span><span class="na">length</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// a datetime string tartalmaz időzóna információt is</span>
<span class="w">            </span><span class="n">ZonedDateTime</span><span class="w"> </span><span class="n">zonedDateTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ZonedDateTime</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="n">string</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">zonedDateTime</span><span class="p">.</span><span class="na">toLocalDate</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// egyszerű string parse</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="n">string</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="p">...</span>

<span class="c1">// Ezt pl. elhelyezhetjük egy saját utility class-ban.</span>
<span class="c1">// Lényegében ő egy kiegészített képességekkel rendelkező Gson objektumot fog létrehozni.</span>

<span class="k">new</span><span class="w"> </span><span class="n">GsonBuilder</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">setPrettyPrinting</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">registerTypeAdapter</span><span class="p">(</span><span class="n">LocalDate</span><span class="w"> </span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LocalDateSerializer</span><span class="p">())</span>
<span class="w">        </span><span class="p">.</span><span class="na">registerTypeAdapter</span><span class="p">(</span><span class="n">LocalDate</span><span class="w"> </span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LocalDateDeserializer</span><span class="p">())</span>
<span class="w">        </span><span class="p">.</span><span class="na">create</span><span class="p">();</span>
</code></pre></div></td></tr></table></div>
<h2 id="viszonykovetes-sutik">Viszonykövetés, sütik<a class="headerlink" href="#viszonykovetes-sutik" title="Permanent link">&para;</a></h2>
<p>Egy újabb fontosabb, és jelenleg talán utolsó témakörünk valamilyen féle viszonykövetés.
Valószínűleg mindenkinek ismerősek lehetnek már a <code>cookie</code>-k, melyeket most felhasználói
preferenciák tárolására fogunk használni. A cookie-k úgy általában is jellemzően valamiféle
felhasználói információt tartalmaznak, melyeket adott webszerver készít el egy kliens
számára, melyek aztán kliens oldalon tárolódnak! Egy <code>session</code>-el ellentétben ez egy fontos
különbség, ugyanis session-t használva a szerverünk megszűnne szigorú értelemben vett
<a href="https://restfulapi.net/index.html">REST</a>ful API-nak lenni. REST esetén ui. egy kitételünk, hogy a
webszerver úgymond állapottól mentes (stateless) legyen, azaz szerveroldalon ne tároljon
semmiféle információt előző kérésekről/válaszokról. Minden kérés önmagában is végrehajtható
kell legyen, rendelkeznie kell a kérés elvégzéséhez szükséges összes információval (pl. user
adatok). A cookie-k kliens oldalon tárolódnak, így ezt a kérdéskört meg is oldják.</p>
<p>A sütiken kívül természetesen léteznek ennek megoldására egyéb webtechnológiák is,
de itt most egyszerűségüknél fogva a cookie-kat választjuk.</p>
<p>Lássuk hogyan is készíthetünk egy cookie gyártó servletet!</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// urlPatterns --&gt; /api/pref, /api/preferences</span>
<span class="nd">@Override</span>
<span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doPost</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">resp</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">ServletException</span><span class="p">,</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">resp</span><span class="p">.</span><span class="na">setContentType</span><span class="p">(</span><span class="n">ContentType</span><span class="p">.</span><span class="na">TEXT_PLAIN</span><span class="p">.</span><span class="na">getMimeType</span><span class="p">());</span>
<span class="w">    </span><span class="n">resp</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">SC_NO_CONTENT</span><span class="p">);</span>

<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">gson</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Gson</span><span class="p">();</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">pref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gson</span><span class="p">.</span><span class="na">fromJson</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="na">getReader</span><span class="p">(),</span><span class="w"> </span><span class="n">Preferences</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">validator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">validatorFactory</span><span class="p">.</span><span class="na">getValidator</span><span class="p">();</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">valResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">validator</span><span class="p">.</span><span class="na">validate</span><span class="p">(</span><span class="n">pref</span><span class="p">);</span>

<span class="w">    </span><span class="n">valResult</span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">el</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">logger</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="n">ValidationLog</span><span class="p">.</span><span class="na">createLog</span><span class="p">(</span><span class="n">el</span><span class="p">)));</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">valResult</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">resp</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">SC_BAD_REQUEST</span><span class="p">);</span>
<span class="w">        </span><span class="n">resp</span><span class="p">.</span><span class="na">getWriter</span><span class="p">().</span><span class="na">println</span><span class="p">(</span><span class="n">gson</span><span class="p">.</span><span class="na">toJson</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Error</span><span class="p">(</span><span class="n">valResult</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">ValidationLog</span><span class="p">::</span><span class="n">createLog</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">joining</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">)))));</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// cookie = new Cookie(&quot;preferences&quot;, someValue)</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">cookie</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CookieBin</span><span class="p">.</span><span class="na">wrapCookie</span><span class="p">(</span><span class="n">ManagedCookies</span><span class="p">.</span><span class="na">PREFERENCES</span><span class="p">.</span><span class="na">toString</span><span class="p">(),</span><span class="w"> </span><span class="n">pref</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// mindenki számára láthatóvá tesszük a cookie-t adott host alatt</span>
<span class="w">    </span><span class="n">cookie</span><span class="p">.</span><span class="na">setPath</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// a cookie egészen az adott kliens bezárásáig maradjon életben</span>
<span class="w">    </span><span class="n">cookie</span><span class="p">.</span><span class="na">setMaxAge</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// hozzáadjuk a sütit a válaszhoz, hogy kliensünk eltárolhassa</span>
<span class="w">    </span><span class="n">resp</span><span class="p">.</span><span class="na">addCookie</span><span class="p">(</span><span class="n">cookie</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>A <code>ManagedCookies</code> egy egyszerű enum, ahol a kezelt sütijeink nevét tároljuk:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">enum</span><span class="w"> </span><span class="n">ManagedCookies</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">PREFERENCES</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nd">@Override</span>
<span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">toString</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">PREFERENCES</span><span class="p">.</span><span class="na">name</span><span class="p">().</span><span class="na">toLowerCase</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>A fenti servletben a user preferenciák szerializálását is megfigyelhetjük <code>CookieBin::wrapCookie</code>,
ahol a következő megfontolások mentén járunk el:</p>
<ul>
<li>vannak user adataink, most preferenciák, amit együtteset szeretnénk kezelni</li>
<li><code>HttpServlet</code> használata esetén a cookie management kicsit limitált olyan tekintetben,
  hogy csak szöveges kulcsok alatt, szöveges értékeket tárolhatunk.</li>
<li>így tehát szeretnénk a kezelt objektumokat egy egyértelmű string formátummá alakítani</li>
</ul>
<p>Mindezek feloldására egyszerűen megköveteljük, hogy az adott cookie egy szerializálható
objektum legyen.
Ezt megtehetjük például a következő módon:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// Először egy SerializationUtils.serialize(cookie) segítségével az adott objektumot</span>
<span class="c1">// egy megfelelő byte[] kóddá alakítjuk, majd ezt kódoljuk egy standard base64 string formátumba.</span>
<span class="k">new</span><span class="w"> </span><span class="n">Cookie</span><span class="p">(</span><span class="s">&quot;some key&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Base64</span><span class="p">.</span><span class="na">getEncoder</span><span class="p">().</span><span class="na">encodeToString</span><span class="p">(</span><span class="n">SerializationUtils</span><span class="p">.</span><span class="na">serialize</span><span class="p">(</span><span class="n">cookie</span><span class="p">)));</span>
</code></pre></div></td></tr></table></div>
<p>A fenti módon adott kulcs alatt tudunk tárolni bármilyen szerializálható objektumot.
Alább pedig lássuk, hogy hogyan deszerializáljuk ugyanezt az objektumot.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// Először dekódoljuk a base64 string-et, majd deszerializáljuk az osztájunkat,</span>
<span class="c1">// hogy visszakapjuk a preferenciákat (vagy egyebet) tartalmazó osztályunkat.</span>
<span class="n">SerializationUtils</span><span class="p">.</span><span class="na">deserialize</span><span class="p">(</span><span class="n">Base64</span><span class="p">.</span><span class="na">getDecoder</span><span class="p">().</span><span class="na">decode</span><span class="p">(</span><span class="n">cookie</span><span class="p">.</span><span class="na">getValue</span><span class="p">()));</span>
</code></pre></div></td></tr></table></div>
<p>Az implementációban felhasználtuk a <code>org.apache.commons.lang3.SerializationUtils</code> osztályt.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">&lt;dependency&gt;</span>
<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>org.apache.commons<span class="nt">&lt;/groupId&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>commons-lang3<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">    </span><span class="nt">&lt;version&gt;</span>3.14.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></td></tr></table></div>
<p>Tegyük hozzá ezt a funckionalitást a read servlethez, hogy valóban csak a user által
beállított preferenciák, mint szűrési feltétel alapján történjek objektumot lekérése.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@Override</span>
<span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">doPost</span><span class="p">(</span><span class="n">HttpServletRequest</span><span class="w"> </span><span class="n">req</span><span class="p">,</span><span class="w"> </span><span class="n">HttpServletResponse</span><span class="w"> </span><span class="n">resp</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">resp</span><span class="p">.</span><span class="na">setContentType</span><span class="p">(</span><span class="n">ContentType</span><span class="p">.</span><span class="na">APPLICATION_JSON</span><span class="p">.</span><span class="na">getMimeType</span><span class="p">());</span>
<span class="w">    </span><span class="n">resp</span><span class="p">.</span><span class="na">setCharacterEncoding</span><span class="p">(</span><span class="n">StandardCharsets</span><span class="p">.</span><span class="na">UTF_8</span><span class="p">.</span><span class="na">name</span><span class="p">());</span>
<span class="w">    </span><span class="n">resp</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">SC_OK</span><span class="p">);</span>

<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">gson</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JsonSupport</span><span class="p">.</span><span class="na">create</span><span class="p">();</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">reqModel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gson</span><span class="p">.</span><span class="na">fromJson</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="na">getReader</span><span class="p">(),</span><span class="w"> </span><span class="n">ReadSightReq</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">validator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">validatorFactory</span><span class="p">.</span><span class="na">getValidator</span><span class="p">();</span>
<span class="w">    </span><span class="n">Set</span><span class="o">&lt;</span><span class="n">ConstraintViolation</span><span class="o">&lt;</span><span class="n">ReadSightReq</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">valResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">reqModel</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">valResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">validator</span><span class="p">.</span><span class="na">validate</span><span class="p">(</span><span class="n">reqModel</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">valResult</span><span class="p">.</span><span class="na">forEach</span><span class="p">(</span><span class="n">el</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">logger</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="n">ValidationLog</span><span class="p">.</span><span class="na">createLog</span><span class="p">(</span><span class="n">el</span><span class="p">)));</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">valResult</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">resp</span><span class="p">.</span><span class="na">setStatus</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">SC_BAD_REQUEST</span><span class="p">);</span>
<span class="w">        </span><span class="n">resp</span><span class="p">.</span><span class="na">getWriter</span><span class="p">().</span><span class="na">println</span><span class="p">(</span><span class="n">gson</span><span class="p">.</span><span class="na">toJson</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Error</span><span class="p">(</span><span class="n">valResult</span><span class="p">.</span><span class="na">stream</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">ValidationLog</span><span class="p">::</span><span class="n">createLog</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">collect</span><span class="p">(</span><span class="n">Collectors</span><span class="p">.</span><span class="na">joining</span><span class="p">(</span><span class="s">&quot;\n&quot;</span><span class="p">)))));</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Sight</span><span class="o">&gt;</span><span class="w"> </span><span class="n">models</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">reqModel</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">models</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">models</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dao</span><span class="p">.</span><span class="na">findAllByCrit</span><span class="p">(</span><span class="n">ConversionSupport</span><span class="p">.</span><span class="na">toModel</span><span class="p">(</span><span class="n">reqModel</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">modelList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StreamSupport</span><span class="p">.</span><span class="na">stream</span><span class="p">(</span><span class="n">models</span><span class="p">.</span><span class="na">spliterator</span><span class="p">(),</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Itt pl. van egy újítás, ahol is az adott kéréstől elkapjuk a sütiket.</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">jar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">req</span><span class="p">.</span><span class="na">getCookies</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Amennyiben nincsenek sütik :(,</span>
<span class="w">    </span><span class="c1">// úgy egyszerűen visszaadjuk szűrés nélküli modelljeinket.</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">jar</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">resp</span><span class="p">.</span><span class="na">getWriter</span><span class="p">().</span><span class="na">println</span><span class="p">(</span><span class="n">gson</span><span class="p">.</span><span class="na">toJson</span><span class="p">(</span><span class="n">modelList</span><span class="p">.</span><span class="na">toList</span><span class="p">()));</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Szűrünk egyet a preferencia kulcs alatt található sütikre.</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="n">prefCookies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arrays</span><span class="p">.</span><span class="na">stream</span><span class="p">(</span><span class="n">jar</span><span class="p">).</span><span class="na">filter</span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Objects</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="na">getName</span><span class="p">(),</span><span class="w"> </span><span class="n">ManagedCookies</span><span class="p">.</span><span class="na">PREFERENCES</span><span class="p">.</span><span class="na">toString</span><span class="p">())).</span><span class="na">toList</span><span class="p">();</span>
<span class="w">    </span><span class="c1">// Amennyiben ez üres, úgy nem történik semmi, ha pedig nem, akkor megtörténik a szűrés.</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">prefCookies</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">pref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CookieBin</span><span class="p">.</span><span class="na">unwrapCookie</span><span class="p">(</span><span class="n">prefCookies</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">Preferences</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// szűrés minimum ár alapján</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pref</span><span class="p">.</span><span class="na">minPrice</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pref</span><span class="p">.</span><span class="na">minPrice</span><span class="p">().</span><span class="na">doubleValue</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">modelList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">modelList</span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">el</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">el</span><span class="p">.</span><span class="na">getPrice</span><span class="p">().</span><span class="na">compareTo</span><span class="p">(</span><span class="n">pref</span><span class="p">.</span><span class="na">minPrice</span><span class="p">())</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// szűrés maximum ár alapján</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pref</span><span class="p">.</span><span class="na">maxPrice</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pref</span><span class="p">.</span><span class="na">maxPrice</span><span class="p">().</span><span class="na">doubleValue</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">modelList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">modelList</span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">el</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">el</span><span class="p">.</span><span class="na">getPrice</span><span class="p">().</span><span class="na">compareTo</span><span class="p">(</span><span class="n">pref</span><span class="p">.</span><span class="na">maxPrice</span><span class="p">())</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// szűrés népszerűség alapján</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pref</span><span class="p">.</span><span class="na">minPopularity</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">pref</span><span class="p">.</span><span class="na">minPopularity</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">modelList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">modelList</span><span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">el</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">el</span><span class="p">.</span><span class="na">getPopularity</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">pref</span><span class="p">.</span><span class="na">minPopularity</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">resp</span><span class="p">.</span><span class="na">getWriter</span><span class="p">().</span><span class="na">println</span><span class="p">(</span><span class="n">gson</span><span class="p">.</span><span class="na">toJson</span><span class="p">(</span><span class="n">modelList</span><span class="p">.</span><span class="na">toList</span><span class="p">()));</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Evvel a <code>doPost</code> módosítással készen is lennénk egy egyszerűbb viszonykövetéssel,
és annak egy lehetséges használatának bemutatásával.</p>
<h2 id="core">Core<a class="headerlink" href="#core" title="Permanent link">&para;</a></h2>
<h3 id="dao">DAO<a class="headerlink" href="#dao" title="Permanent link">&para;</a></h3>
<p>DAO megvalósításaink során egy jobb alternatíva lehet, ha Data Access Object-jeink
adatbázis implementációtól függetlenek. Vagy legalábbis azon forrást ne cipeljék magukkal,
hogy honnan is szedik a <code>Connection</code> által reprezentált adatbázis csatlakozásukat.</p>
<p>Erre egy jó megoldás, ha a DAO egyes implementációi többek között rendelkeznek evvel a
konstruktor paraméterrel. Azaz:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">// Saját DAO implementáció, avagy mire is jó egy osztály</span>
<span class="kd">class</span> <span class="nc">MyDaoImpl</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="p">...</span>

<span class="w">  </span><span class="c1">// DataSource kívülről fog jönni, nekünk csupán</span>
<span class="w">  </span><span class="c1">// példányosításkor kell eldöntenünk, hogy ki legyen az.</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="nf">MyDaoImpl</span><span class="p">(</span><span class="n">DataSource</span><span class="w"> </span><span class="n">dataSource</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="na">dataSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dataSource</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="p">...</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Egy <code>DataSource</code>-nak kötelessége megvalósítani a <code>getConnection</code> metódust, így
egy beégetett <code>DriverManager::getConnection</code> helyett könnyedén használhatjuk akár
saját <code>DataSource</code> implementációnkat is, melyhez nem kötjük hozzá szigorúan az adott
DAO implementációnkat.</p>
<p>Egy <code>DataSource</code> kiszolgálását elintézhetünk több módon is, de lássunk példaként egy
<em>Factory</em>, és egy <em>Singleton</em> megvalósítás együttesét. Ezek természetesen egymástól függetlenül
is használhatók.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SingletonSQLiteJDBCDataSource</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">DSService</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">SQLiteDataSource</span><span class="w"> </span><span class="n">dataSource</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">KeepAliveConnection</span><span class="w"> </span><span class="n">keepAlive</span><span class="p">;</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="nf">SingletonSQLiteJDBCDataSource</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">keepAlive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">KeepAliveConnection</span><span class="p">();</span>
<span class="w">        </span><span class="n">dataSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SQLiteDataSourceFactory</span><span class="p">().</span><span class="na">getDataSource</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">SingletonSQLiteJDBCDataSource</span><span class="w"> </span><span class="nf">getInstance</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Instance</span><span class="p">.</span><span class="na">INSTANCE</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Ezt a metódust kellene majd használni, mikor egy DAO példányosítása történik.</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">DataSource</span><span class="w"> </span><span class="nf">getDataSource</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">dataSource</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Instance</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">SingletonSQLiteJDBCDataSource</span><span class="w"> </span><span class="n">INSTANCE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SingletonSQLiteJDBCDataSource</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">close</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">DSService</span><span class="p">.</span><span class="na">super</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">keepAlive</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="n">e</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>amely megvalósításban a DSService a következő interface-nek felel meg:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">DSService</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">AutoCloseable</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// szeretnénk ha biztosan rendelkezne egy ilyen metódussal,</span>
<span class="w">  </span><span class="c1">// hiszen ez az ok, amiért készül</span>
<span class="w">  </span><span class="n">DataSource</span><span class="w"> </span><span class="nf">getDataSource</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// amennyiben a ds objektumunk rendelkezik close metódussal,</span>
<span class="w">  </span><span class="c1">// úgy bezárjuk azt</span>
<span class="w">  </span><span class="nd">@Override</span>
<span class="w">  </span><span class="k">default</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">close</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">getDataSource</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">getDataSource</span><span class="p">()</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">AutoCloseable</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="p">((</span><span class="n">AutoCloseable</span><span class="p">)</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">getDataSource</span><span class="p">()).</span><span class="na">close</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>A keepAlive connection esetünkben pedig egészen egyszerűen azért felelős, hogy
adatbázisunk (amennyiben memóriában él) biztosan rendelkezzék legalább egy élő
session-el. Erre azért van szükség, mert egy memory-db esetén az utolsó connection
elzárásakor az adatbázis törlődni fog! Ez van, hogy kellemes tulajdonság, azonban
jelenleg ez egy nem kívánatos mellékhatása lenne egy memória adatbázisnak. Tegyünk
hát ez ellen!</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">KeepAliveConnection</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">AutoCloseable</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">Connection</span><span class="w"> </span><span class="n">connection</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// Kérünk egy connection-t, melyet majd ahol kell életben tartunk.</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">KeepAliveConnection</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DriverManager</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="n">ConfigSupport</span><span class="p">.</span><span class="na">getDbUrl</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">SQLException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">close</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">connection</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>A <em>factory</em> osztályunk pedig jelenleg a következő:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SQLiteDataSourceFactory</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">SQLiteConfig</span><span class="w"> </span><span class="n">config</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">url</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">SQLiteDataSourceFactory</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">(</span><span class="n">ConfigSupport</span><span class="p">.</span><span class="na">getDbUrl</span><span class="p">(),</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SQLiteConfig</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">SQLiteDataSourceFactory</span><span class="p">(</span><span class="n">SQLiteConfig</span><span class="w"> </span><span class="n">cfg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">(</span><span class="n">ConfigSupport</span><span class="p">.</span><span class="na">getDbUrl</span><span class="p">(),</span><span class="w"> </span><span class="n">cfg</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">SQLiteDataSourceFactory</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">conn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">SQLiteDataSourceFactory</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">conn</span><span class="p">,</span><span class="w"> </span><span class="n">SQLiteConfig</span><span class="w"> </span><span class="n">cfg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="p">;</span>
<span class="w">        </span><span class="n">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cfg</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// itt készül el a datasource</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">SQLiteDataSource</span><span class="w"> </span><span class="nf">getDataSource</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">ds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SQLiteDataSource</span><span class="p">(</span><span class="n">config</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">url</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">ds</span><span class="p">.</span><span class="na">setUrl</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ds</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>A datasource kreálása egy robusztusabb használat érdekében el van szeparálva, azonban
teljesen mindegy, hogy ilyen módon készítjük el a <code>DataSource</code> objektumunkat, avagy
egyszerűen csak singleton osztályunkban létrehozunk egyet valamiféle alapbeállítással,
eredményünk használattól függően ugyanaz lehet.</p>
<p>Egy sqlite data source elkészítése csupán a következőket igényli:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="n">ds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SQLiteDataSource</span><span class="p">();</span>
<span class="n">ds</span><span class="p">.</span><span class="na">setUrl</span><span class="p">(</span><span class="s">&quot;jdbc:sqlite:some connection string&quot;</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<h3 id="jooq">jOOQ<a class="headerlink" href="#jooq" title="Permanent link">&para;</a></h3>
<p>jOOQ csomag használatával</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">&lt;dependency&gt;</span>
<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>org.jooq<span class="nt">&lt;/groupId&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>jooq<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">    </span><span class="nt">&lt;version&gt;</span>3.19.6<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></td></tr></table></div>
<p>már valóban SQL dialektustól független DAO implementációkat készíthetünk!
Ehhez csupán meg kell adjunk egy elérhetőséget adatbázisunkhoz, valamint azt,
hogy milyen <code>dialect</code> az, amit használni szeretnénk. A jOOQ szinte bármely
elképzelhető SQL parancsok létrehozásában segíthet nekünk:</p>
<ul>
<li>SQLITE</li>
<li>H2</li>
<li>MYSQL</li>
<li>POSTGRES</li>
<li>ORACLE</li>
<li>MARIADB</li>
</ul>
<p>és még sok más!</p>
<p>Egy lehetséges megvalósítás a fenti megfontolások figyelembevételével a következő lehet,
például a látnivalók esetén.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">SightJooqDao</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Dao</span><span class="o">&lt;</span><span class="n">Long</span><span class="p">,</span><span class="w"> </span><span class="n">Sight</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// A tábla neve, amelyet használunk</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">TABLE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;sight&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Szeretnénk majd kapni egy ds-t, amit itt tárolunk</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">DataSource</span><span class="w"> </span><span class="n">dataSource</span><span class="p">;</span>
<span class="w">    </span><span class="c1">// Szeretnénk kapni egy sql-dialect-et is</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">SQLDialect</span><span class="w"> </span><span class="n">sqlDialect</span><span class="p">;</span><span class="w">  </span><span class="c1">// = SQLDialect.SQLITE</span>

<span class="w">    </span><span class="c1">// Egy nekünk megfelelő konstruktor</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">SightJooqDao</span><span class="p">(</span><span class="n">DataSource</span><span class="w"> </span><span class="n">ds</span><span class="p">,</span><span class="w"> </span><span class="n">SQLDialect</span><span class="w"> </span><span class="n">dialect</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">dataSource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ds</span><span class="p">;</span>
<span class="w">        </span><span class="n">sqlDialect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dialect</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Record osztályból beolvassuk a megfelelő mezőket.</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Sight</span><span class="w"> </span><span class="nf">readRecord</span><span class="p">(</span><span class="n">Record</span><span class="w"> </span><span class="n">record</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Sight</span><span class="p">(</span>
<span class="w">                </span><span class="kd">record</span><span class="err">.</span><span class="nc">get</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Long</span><span class="p">.</span><span class="na">class</span><span class="p">),</span>
<span class="w">                </span><span class="kd">record</span><span class="err">.</span><span class="nc">get</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">),</span>
<span class="w">                </span><span class="kd">record</span><span class="err">.</span><span class="nc">get</span><span class="p">(</span><span class="s">&quot;price&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">.</span><span class="na">class</span><span class="p">),</span>
<span class="w">                </span><span class="kd">record</span><span class="err">.</span><span class="nc">get</span><span class="p">(</span><span class="s">&quot;opening&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">class</span><span class="p">),</span>
<span class="w">                </span><span class="kd">record</span><span class="err">.</span><span class="nc">get</span><span class="p">(</span><span class="s">&quot;closing&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">class</span><span class="p">),</span>
<span class="w">                </span><span class="kd">record</span><span class="err">.</span><span class="nc">get</span><span class="p">(</span><span class="s">&quot;description&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">),</span>
<span class="w">                </span><span class="kd">record</span><span class="err">.</span><span class="nc">get</span><span class="p">(</span><span class="s">&quot;popularity&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">class</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// Készítünk egy Map-ot megfelelő mezőkkel, melyeknek</span>
<span class="w">    </span><span class="c1">// megadjuk, hogy amennyiben léteznek az objektum által</span>
<span class="w">    </span><span class="c1">// reprezentált mezők alatti értékek, úgy adatbázis</span>
<span class="w">    </span><span class="c1">// szinten is szeretnénk ezeket beállítani.</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">Field</span><span class="o">&lt;?&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">getSetValues</span><span class="p">(</span><span class="n">Sight</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">Field</span><span class="o">&lt;?&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="na">getName</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">set</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)),</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="na">getPrice</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">set</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;price&quot;</span><span class="p">)),</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="na">getPrice</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="na">getOpeningHour</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">set</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;opening&quot;</span><span class="p">)),</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="na">getOpeningHour</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="na">getClosingHour</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">set</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;closing&quot;</span><span class="p">)),</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="na">getClosingHour</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="na">getDescription</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">set</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;description&quot;</span><span class="p">)),</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="na">getDescription</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="na">getPopularity</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">set</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;popularity&quot;</span><span class="p">)),</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="na">getPopularity</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">set</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="n">Sight</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">assert</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// felsoroljuk a mezőket melyeknek értékeket szeretnénk majd adni</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">columns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span>
<span class="w">                </span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)),</span>
<span class="w">                </span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;price&quot;</span><span class="p">)),</span>
<span class="w">                </span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;opening&quot;</span><span class="p">)),</span>
<span class="w">                </span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;closing&quot;</span><span class="p">)),</span>
<span class="w">                </span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;description&quot;</span><span class="p">)),</span>
<span class="w">                </span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;popularity&quot;</span><span class="p">)));</span>
<span class="w">        </span><span class="c1">// felsoroljuk a beállítandó értékeket</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span>
<span class="w">                </span><span class="n">model</span><span class="p">.</span><span class="na">getName</span><span class="p">(),</span>
<span class="w">                </span><span class="n">model</span><span class="p">.</span><span class="na">getPrice</span><span class="p">(),</span>
<span class="w">                </span><span class="n">model</span><span class="p">.</span><span class="na">getOpeningHour</span><span class="p">(),</span>
<span class="w">                </span><span class="n">model</span><span class="p">.</span><span class="na">getClosingHour</span><span class="p">(),</span>
<span class="w">                </span><span class="n">model</span><span class="p">.</span><span class="na">getDescription</span><span class="p">(),</span>
<span class="w">                </span><span class="n">model</span><span class="p">.</span><span class="na">getPopularity</span><span class="p">());</span>

<span class="w">        </span><span class="c1">// mentés, és utolsó beillesztett ID lekérése</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DSL</span><span class="p">.</span><span class="na">using</span><span class="p">(</span><span class="n">dataSource</span><span class="p">,</span><span class="w"> </span><span class="n">sqlDialect</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">insertInto</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="n">TABLE</span><span class="p">)))</span><span class="w">  </span><span class="c1">// szeretnék rekordot hozzáadni</span>
<span class="w">                </span><span class="p">.</span><span class="na">columns</span><span class="p">(</span><span class="n">columns</span><span class="p">)</span><span class="w">  </span><span class="c1">// ezen oszlopok felhasználásával</span>
<span class="w">                </span><span class="p">.</span><span class="na">values</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="w">  </span><span class="c1">// ezen értékekkel</span>
<span class="w">                </span><span class="p">.</span><span class="na">returningResult</span><span class="p">(</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)))</span><span class="w">  </span><span class="c1">// add vissza az id-t</span>
<span class="w">                </span><span class="p">.</span><span class="na">fetchOne</span><span class="p">(</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)),</span><span class="w"> </span><span class="n">Long</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w">  </span><span class="c1">// query</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">setId</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">Sight</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findById</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">assert</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">        </span><span class="c1">// lekérünk egy darab rekordot</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Optional</span><span class="p">.</span><span class="na">ofNullable</span><span class="p">(</span><span class="n">DSL</span><span class="p">.</span><span class="na">using</span><span class="p">(</span><span class="n">dataSource</span><span class="p">,</span><span class="w"> </span><span class="n">sqlDialect</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">select</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">TABLE</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">where</span><span class="p">(</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)).</span><span class="na">eq</span><span class="p">(</span><span class="n">id</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">fetchOne</span><span class="p">(</span><span class="k">this</span><span class="p">::</span><span class="n">readRecord</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Sight</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findAll</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">DSL</span><span class="p">.</span><span class="na">using</span><span class="p">(</span><span class="n">dataSource</span><span class="p">,</span><span class="w"> </span><span class="n">sqlDialect</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">select</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">TABLE</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">fetch</span><span class="p">(</span><span class="k">this</span><span class="p">::</span><span class="n">readRecord</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Sight</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findAllByIds</span><span class="p">(</span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ids</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">assert</span><span class="w"> </span><span class="n">ids</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StreamSupport</span><span class="p">.</span><span class="na">stream</span><span class="p">(</span><span class="n">ids</span><span class="p">.</span><span class="na">spliterator</span><span class="p">(),</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)).</span><span class="na">eq</span><span class="p">(</span><span class="n">id</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">toList</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">DSL</span><span class="p">.</span><span class="na">using</span><span class="p">(</span><span class="n">dataSource</span><span class="p">,</span><span class="w"> </span><span class="n">sqlDialect</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">select</span><span class="p">()</span><span class="w">  </span><span class="c1">// select statement</span>
<span class="w">                </span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">TABLE</span><span class="p">)</span><span class="w">  </span><span class="c1">// honnan szeretném?</span>
<span class="w">                </span><span class="p">.</span><span class="na">where</span><span class="p">(</span><span class="n">or</span><span class="p">(</span><span class="n">where</span><span class="p">))</span><span class="w">  </span><span class="c1">// milyen feltételekkel?</span>
<span class="w">                </span><span class="p">.</span><span class="na">fetch</span><span class="p">(</span><span class="k">this</span><span class="p">::</span><span class="n">readRecord</span><span class="p">);</span><span class="w">  </span><span class="c1">// query</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Sight</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">findAllByCrit</span><span class="p">(</span><span class="n">Sight</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">assert</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Condition</span><span class="o">&gt;</span><span class="p">();</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="na">getId</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">where</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)).</span><span class="na">eq</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="na">getId</span><span class="p">()));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="na">getName</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">where</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)).</span><span class="na">likeIgnoreCase</span><span class="p">(</span><span class="s">&quot;%&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="na">getName</span><span class="p">().</span><span class="na">replace</span><span class="p">(</span><span class="s">&quot;%&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;\\%&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;%&quot;</span><span class="p">).</span><span class="na">escape</span><span class="p">(</span><span class="sc">&#39;\\&#39;</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="na">getPrice</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">where</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;price&quot;</span><span class="p">)).</span><span class="na">eq</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="na">getPrice</span><span class="p">()));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="na">getOpeningHour</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">where</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;opening&quot;</span><span class="p">)).</span><span class="na">eq</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="na">getOpeningHour</span><span class="p">()));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="na">getClosingHour</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">where</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;closing&quot;</span><span class="p">)).</span><span class="na">eq</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="na">getClosingHour</span><span class="p">()));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="na">getDescription</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">where</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;description&quot;</span><span class="p">)).</span><span class="na">likeIgnoreCase</span><span class="p">(</span><span class="s">&quot;%&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="na">getDescription</span><span class="p">().</span><span class="na">replace</span><span class="p">(</span><span class="s">&quot;%&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;\\%&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;%&quot;</span><span class="p">).</span><span class="na">escape</span><span class="p">(</span><span class="sc">&#39;\\&#39;</span><span class="p">));</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="na">getPopularity</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">where</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;popularity&quot;</span><span class="p">)).</span><span class="na">eq</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="na">getPopularity</span><span class="p">()));</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">DSL</span><span class="p">.</span><span class="na">using</span><span class="p">(</span><span class="n">dataSource</span><span class="p">,</span><span class="w"> </span><span class="n">sqlDialect</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">select</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">TABLE</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">where</span><span class="p">(</span><span class="n">and</span><span class="p">(</span><span class="n">where</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">fetch</span><span class="p">(</span><span class="k">this</span><span class="p">::</span><span class="n">readRecord</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">deleteById</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">assert</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">DSL</span><span class="p">.</span><span class="na">using</span><span class="p">(</span><span class="n">dataSource</span><span class="p">,</span><span class="w"> </span><span class="n">sqlDialect</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">deleteFrom</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="n">TABLE</span><span class="p">)))</span><span class="w">  </span><span class="c1">// szeretnék törölni</span>
<span class="w">                </span><span class="p">.</span><span class="na">where</span><span class="p">(</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)).</span><span class="na">eq</span><span class="p">(</span><span class="n">id</span><span class="p">))</span><span class="w">  </span><span class="c1">// ezen feltétellel</span>
<span class="w">                </span><span class="p">.</span><span class="na">execute</span><span class="p">();</span><span class="w">  </span><span class="c1">// dew it!</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">deleteAllByIds</span><span class="p">(</span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ids</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">assert</span><span class="w"> </span><span class="n">ids</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StreamSupport</span><span class="p">.</span><span class="na">stream</span><span class="p">(</span><span class="n">ids</span><span class="p">.</span><span class="na">spliterator</span><span class="p">(),</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)).</span><span class="na">eq</span><span class="p">(</span><span class="n">id</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">toList</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">DSL</span><span class="p">.</span><span class="na">using</span><span class="p">(</span><span class="n">dataSource</span><span class="p">,</span><span class="w"> </span><span class="n">sqlDialect</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">deleteFrom</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="n">TABLE</span><span class="p">)))</span>
<span class="w">                </span><span class="p">.</span><span class="na">where</span><span class="p">(</span><span class="n">or</span><span class="p">(</span><span class="n">where</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">execute</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">updateById</span><span class="p">(</span><span class="n">Long</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">Sight</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">assert</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// ez egy field -&gt; value map</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getSetValues</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">set</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">DSL</span><span class="p">.</span><span class="na">using</span><span class="p">(</span><span class="n">dataSource</span><span class="p">,</span><span class="w"> </span><span class="n">sqlDialect</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">update</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="n">TABLE</span><span class="p">)))</span><span class="w">  </span><span class="c1">// csinálj egy update statementet</span>
<span class="w">                </span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">set</span><span class="p">)</span><span class="w">  </span><span class="c1">// ezeket szeretném setelni</span>
<span class="w">                </span><span class="p">.</span><span class="na">where</span><span class="p">(</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)).</span><span class="na">eq</span><span class="p">(</span><span class="n">id</span><span class="p">))</span><span class="w">  </span><span class="c1">// ezen feltétel mellett</span>
<span class="w">                </span><span class="p">.</span><span class="na">execute</span><span class="p">();</span><span class="w">  </span><span class="c1">// dew it!</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">updateAllByIds</span><span class="p">(</span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ids</span><span class="p">,</span><span class="w"> </span><span class="n">Sight</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">assert</span><span class="w"> </span><span class="n">ids</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>

<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getSetValues</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">set</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StreamSupport</span><span class="p">.</span><span class="na">stream</span><span class="p">(</span><span class="n">ids</span><span class="p">.</span><span class="na">spliterator</span><span class="p">(),</span><span class="w"> </span><span class="kc">false</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">map</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)).</span><span class="na">eq</span><span class="p">(</span><span class="n">id</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">toList</span><span class="p">();</span>
<span class="w">        </span><span class="c1">// By design choice if there are no conditions, we update all records</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">where</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">where</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">List</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">noCondition</span><span class="p">());</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">DSL</span><span class="p">.</span><span class="na">using</span><span class="p">(</span><span class="n">dataSource</span><span class="p">,</span><span class="w"> </span><span class="n">sqlDialect</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">update</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="n">TABLE</span><span class="p">)))</span>
<span class="w">                </span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">set</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">where</span><span class="p">(</span><span class="n">or</span><span class="p">(</span><span class="n">where</span><span class="p">))</span>
<span class="w">                </span><span class="p">.</span><span class="na">execute</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// db pusztítás</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">prune</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// pusztuljon el mindenki!</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">DSL</span><span class="p">.</span><span class="na">using</span><span class="p">(</span><span class="n">dataSource</span><span class="p">,</span><span class="w"> </span><span class="n">sqlDialect</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">deleteFrom</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="n">TABLE</span><span class="p">))).</span><span class="na">execute</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// rekord számlálás</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">count</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// hányan gyűltünk itt össze?</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">DSL</span><span class="p">.</span><span class="na">using</span><span class="p">(</span><span class="n">dataSource</span><span class="p">,</span><span class="w"> </span><span class="n">sqlDialect</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="na">fetchCount</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="n">TABLE</span><span class="p">)));</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>A DAO pedig, ebben az esetben egy ennek megfelelő interface:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">interface</span> <span class="nc">Dao</span><span class="o">&lt;</span><span class="n">ID</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// itt bújnak a fent megvalósított metódusok.</span>
<span class="w">    </span><span class="p">...</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>jOOQ esetén általában elmondható, hogy akkor használjuk megfelelően
a könyvtárat, ha egyetlen egy, láncolható DSL utasítással hajtjuk végre
a kívánt lekérdezést. Legyen ez a CRUD bármely eleme is.</p>
<p>Pl., amit ne csináljunk:
<a href="https://blog.jooq.org/create-empty-optional-sql-clauses-with-jooq/index.html">how, and how not to do</a></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="n">dsl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DSL</span><span class="p">.</span><span class="na">using</span><span class="p">(</span><span class="n">dataSource</span><span class="p">,</span><span class="w"> </span><span class="n">sqlDialect</span><span class="p">);</span>
<span class="kd">var</span><span class="w"> </span><span class="n">sel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dsl</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">))).</span><span class="na">from</span><span class="p">(</span><span class="n">TABLE</span><span class="p">);</span>
<span class="kd">var</span><span class="w"> </span><span class="n">cond</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sel</span><span class="p">.</span><span class="na">where</span><span class="p">(</span><span class="n">noCondition</span><span class="p">());</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ids</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">cond</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cond</span><span class="p">.</span><span class="na">or</span><span class="p">(</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)).</span><span class="na">eq</span><span class="p">(</span><span class="n">id</span><span class="p">));</span>
<span class="p">}</span>
<span class="kd">var</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cond</span><span class="p">.</span><span class="na">fetch</span><span class="p">();</span>
</code></pre></div></td></tr></table></div>
<p>Igaz, hogy az api úgy néz ki, mintha még szeretné is ezt, de nem. Ne kínozzuk se magunkat, se mást.
Nyugodtan alakítsuk csak ki a fenti condition-t külön. Könnyedén össze lehet fűzni azt utólag.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ids</span><span class="p">.</span><span class="na">stream</span><span class="p">().</span><span class="na">map</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)).</span><span class="na">eq</span><span class="p">(</span><span class="n">id</span><span class="p">))</span>
<span class="w">        </span><span class="p">.</span><span class="na">toList</span><span class="p">();</span>
<span class="kd">var</span><span class="w"> </span><span class="n">record</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DSL</span><span class="p">.</span><span class="na">using</span><span class="p">(</span><span class="n">dataSource</span><span class="p">,</span><span class="w"> </span><span class="n">sqlDialect</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">select</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">TABLE</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">where</span><span class="p">(</span><span class="n">or</span><span class="p">(</span><span class="n">where</span><span class="p">))</span><span class="w">  </span><span class="c1">// Na így már sokkal szebb, és nem is kínlódtunk annyit.</span>
<span class="w">        </span><span class="p">.</span><span class="na">fetch</span><span class="p">();</span>
</code></pre></div></td></tr></table></div>
<hr />
<h2 id="system">System<a class="headerlink" href="#system" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th></th>
<th>Version</th>
</tr>
</thead>
<tbody>
<tr>
<td>Java</td>
<td>17</td>
</tr>
<tr>
<td>Maven</td>
<td>3.9.6</td>
</tr>
</tbody>
</table>

  <hr>
<div class="md-source-file">
  <small>
    
      Utolsó frissítés:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_datetime">2024-04-09 17:53:17</span>
      
    
  </small>
</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2004-2024 Szegedi Tudományegyetem, Informatikai Intézet, Szoftverfejlesztés Tanszék
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/index.html" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["tabs"], "search": "../assets/javascripts/workers/search.db81ec45.min.js", "translations": {"clipboard.copied": "V\u00e1g\u00f3lapra m\u00e1solva", "clipboard.copy": "M\u00e1sol\u00e1s v\u00e1g\u00f3lapra", "search.result.more.one": "1 tov\u00e1bbi tal\u00e1lat az oldalon", "search.result.more.other": "# tov\u00e1bbi tal\u00e1lat az oldalon", "search.result.none": "Nincs tal\u00e1lat", "search.result.one": "1 egyez\u0151 dokumentum", "search.result.other": "# egyez\u0151 dokumentum", "search.result.placeholder": "Keres\u00e9shez \u00edrj ide valamit", "search.result.term.missing": "\u00dcres", "select.version": "Verzi\u00f3v\u00e1lt\u00e1s"}}</script>
    
    
      <script src="../assets/javascripts/bundle.a00a7c5e.min.js"></script>
      
        <script src="../js/main.js"></script>
      
    
  </body>
</html>